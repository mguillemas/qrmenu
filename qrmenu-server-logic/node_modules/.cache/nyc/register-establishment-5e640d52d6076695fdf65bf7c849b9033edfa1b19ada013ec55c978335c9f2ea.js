function cov_23x1n2e798(){var path="/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/register-establishment.js";var hash="8f6b52cd9ed6e5e6d1fbbf847a1bf2b4e9115314";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/register-establishment.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:42}},"1":{start:{line:2,column:0},end:{line:2,column:40}},"2":{start:{line:3,column:61},end:{line:3,column:86}},"3":{start:{line:4,column:36},end:{line:4,column:58}},"4":{start:{line:5,column:15},end:{line:5,column:34}},"5":{start:{line:7,column:0},end:{line:27,column:1}},"6":{start:{line:8,column:4},end:{line:8,column:42}},"7":{start:{line:9,column:4},end:{line:9,column:32}},"8":{start:{line:10,column:4},end:{line:10,column:21}},"9":{start:{line:11,column:4},end:{line:11,column:34}},"10":{start:{line:12,column:4},end:{line:12,column:25}},"11":{start:{line:13,column:4},end:{line:13,column:37}},"12":{start:{line:15,column:4},end:{line:26,column:8}},"13":{start:{line:16,column:8},end:{line:16,column:16}},"14":{start:{line:17,column:31},end:{line:17,column:67}},"15":{start:{line:19,column:8},end:{line:19,column:90}},"16":{start:{line:19,column:27},end:{line:19,column:90}},"17":{start:{line:21,column:21},end:{line:21,column:52}},"18":{start:{line:23,column:8},end:{line:23,column:106}},"19":{start:{line:25,column:8},end:{line:25,column:14}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:17},end:{line:7,column:18}},loc:{start:{line:7,column:58},end:{line:27,column:1}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:15,column:12},end:{line:15,column:13}},loc:{start:{line:15,column:23},end:{line:26,column:5}},line:15}},branchMap:{"0":{loc:{start:{line:19,column:8},end:{line:19,column:90}},type:"if",locations:[{start:{line:19,column:8},end:{line:19,column:90}},{start:{line:19,column:8},end:{line:19,column:90}}],line:19}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},f:{"0":0,"1":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"8f6b52cd9ed6e5e6d1fbbf847a1bf2b4e9115314"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_23x1n2e798=function(){return actualCoverage;};}return actualCoverage;}cov_23x1n2e798();cov_23x1n2e798().s[0]++;require('qrmenu-commons/polyfills/string');cov_23x1n2e798().s[1]++;require('qrmenu-commons/polyfills/json');const{utils:{Email,NIF},errors:{DuplicityError}}=(cov_23x1n2e798().s[2]++,require('qrmenu-commons'));const{models:{Establishment}}=(cov_23x1n2e798().s[3]++,require('qrmenu-data'));const bcrypt=(cov_23x1n2e798().s[4]++,require('bcryptjs'));cov_23x1n2e798().s[5]++;module.exports=(establishment,nif,email,password)=>{cov_23x1n2e798().f[0]++;cov_23x1n2e798().s[6]++;String.validate.notVoid(establishment);cov_23x1n2e798().s[7]++;String.validate.notVoid(nif);cov_23x1n2e798().s[8]++;NIF.validate(nif);cov_23x1n2e798().s[9]++;String.validate.notVoid(email);cov_23x1n2e798().s[10]++;Email.validate(email);cov_23x1n2e798().s[11]++;String.validate.notVoid(password);cov_23x1n2e798().s[12]++;return(async()=>{cov_23x1n2e798().f[1]++;cov_23x1n2e798().s[13]++;debugger;const _establishment=(cov_23x1n2e798().s[14]++,await Establishment.findOne({nif}));cov_23x1n2e798().s[15]++;if(_establishment){cov_23x1n2e798().b[0][0]++;cov_23x1n2e798().s[16]++;throw new DuplicityError(`user with nif ${nif} already exists`);}else{cov_23x1n2e798().b[0][1]++;}const hash=(cov_23x1n2e798().s[17]++,await bcrypt.hash(password,10));cov_23x1n2e798().s[18]++;await Establishment.create({establishment,nif,staff:[{email,role:'owner',password:hash}]});cov_23x1n2e798().s[19]++;return;})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZ2lzdGVyLWVzdGFibGlzaG1lbnQuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsInV0aWxzIiwiRW1haWwiLCJOSUYiLCJlcnJvcnMiLCJEdXBsaWNpdHlFcnJvciIsIm1vZGVscyIsIkVzdGFibGlzaG1lbnQiLCJiY3J5cHQiLCJtb2R1bGUiLCJleHBvcnRzIiwiZXN0YWJsaXNobWVudCIsIm5pZiIsImVtYWlsIiwicGFzc3dvcmQiLCJTdHJpbmciLCJ2YWxpZGF0ZSIsIm5vdFZvaWQiLCJfZXN0YWJsaXNobWVudCIsImZpbmRPbmUiLCJoYXNoIiwiY3JlYXRlIiwic3RhZmYiLCJyb2xlIl0sIm1hcHBpbmdzIjoiKzZFQWVZO21IQWZaQSxPQUFPLENBQUMsaUNBQUQsQ0FBUCxDLHdCQUNBQSxPQUFPLENBQUMsK0JBQUQsQ0FBUCxDQUNBLEtBQU0sQ0FBRUMsS0FBSyxDQUFFLENBQUVDLEtBQUYsQ0FBU0MsR0FBVCxDQUFULENBQXlCQyxNQUFNLENBQUUsQ0FBRUMsY0FBRixDQUFqQywyQkFBdURMLE9BQU8sQ0FBQyxnQkFBRCxDQUE5RCxDQUFOLENBQ0EsS0FBTSxDQUFFTSxNQUFNLENBQUUsQ0FBQ0MsYUFBRCxDQUFWLDJCQUE4QlAsT0FBTyxDQUFDLGFBQUQsQ0FBckMsQ0FBTixDQUNBLEtBQU1RLENBQUFBLE1BQU0sMEJBQUdSLE9BQU8sQ0FBQyxVQUFELENBQVYsQ0FBWixDLHdCQUVBUyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBQ0MsYUFBRCxDQUFnQkMsR0FBaEIsQ0FBcUJDLEtBQXJCLENBQTRCQyxRQUE1QixHQUF5QyxpREFDdERDLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0JOLGFBQXhCLEVBRHNELHdCQUV0REksTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3QkwsR0FBeEIsRUFGc0Qsd0JBR3REVCxHQUFHLENBQUNhLFFBQUosQ0FBYUosR0FBYixFQUhzRCx3QkFJdERHLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0JKLEtBQXhCLEVBSnNELHlCQUt0RFgsS0FBSyxDQUFDYyxRQUFOLENBQWVILEtBQWYsRUFMc0QseUJBTXRERSxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLE9BQWhCLENBQXdCSCxRQUF4QixFQU5zRCx5QkFRdEQsTUFBTyxDQUFDLFNBQVcsa0RBQ2YsU0FDQSxLQUFNSSxDQUFBQSxjQUFjLDJCQUFHLEtBQU1YLENBQUFBLGFBQWEsQ0FBQ1ksT0FBZCxDQUFzQixDQUFFUCxHQUFGLENBQXRCLENBQVQsQ0FBcEIsQ0FGZSx5QkFJZixHQUFHTSxjQUFILENBQW1CLDBEQUFNLElBQUliLENBQUFBLGNBQUosQ0FBb0IsaUJBQWdCTyxHQUFJLGlCQUF4QyxDQUFOLENBQStELENBQWxGLGlDQUVBLEtBQU1RLENBQUFBLElBQUksMkJBQUcsS0FBTVosQ0FBQUEsTUFBTSxDQUFDWSxJQUFQLENBQVlOLFFBQVosQ0FBc0IsRUFBdEIsQ0FBVCxDQUFWLENBTmUseUJBUWYsS0FBTVAsQ0FBQUEsYUFBYSxDQUFDYyxNQUFkLENBQXFCLENBQUVWLGFBQUYsQ0FBaUJDLEdBQWpCLENBQXNCVSxLQUFLLENBQUUsQ0FBQyxDQUFDVCxLQUFELENBQVFVLElBQUksQ0FBRSxPQUFkLENBQXVCVCxRQUFRLENBQUVNLElBQWpDLENBQUQsQ0FBN0IsQ0FBckIsQ0FBTixDQVJlLHlCQVVmLE9BQ0gsQ0FYTSxHQUFQLENBWUgsQ0FwQkQiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCdxcm1lbnUtY29tbW9ucy9wb2x5ZmlsbHMvc3RyaW5nJylcbnJlcXVpcmUoJ3FybWVudS1jb21tb25zL3BvbHlmaWxscy9qc29uJylcbmNvbnN0IHsgdXRpbHM6IHsgRW1haWwsIE5JRiB9LCBlcnJvcnM6IHsgRHVwbGljaXR5RXJyb3IgfX0gPSByZXF1aXJlKCdxcm1lbnUtY29tbW9ucycpXG5jb25zdCB7IG1vZGVsczoge0VzdGFibGlzaG1lbnR9IH0gPSByZXF1aXJlKCdxcm1lbnUtZGF0YScpXG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKCdiY3J5cHRqcycpXG5cbm1vZHVsZS5leHBvcnRzID0gKGVzdGFibGlzaG1lbnQsIG5pZiwgZW1haWwsIHBhc3N3b3JkKSA9PiB7XG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQoZXN0YWJsaXNobWVudClcbiAgICBTdHJpbmcudmFsaWRhdGUubm90Vm9pZChuaWYpXG4gICAgTklGLnZhbGlkYXRlKG5pZilcbiAgICBTdHJpbmcudmFsaWRhdGUubm90Vm9pZChlbWFpbClcbiAgICBFbWFpbC52YWxpZGF0ZShlbWFpbClcbiAgICBTdHJpbmcudmFsaWRhdGUubm90Vm9pZChwYXNzd29yZClcblxuICAgIHJldHVybiAoYXN5bmMoKSA9PiB7XG4gICAgICAgIGRlYnVnZ2VyXG4gICAgICAgIGNvbnN0IF9lc3RhYmxpc2htZW50ID0gYXdhaXQgRXN0YWJsaXNobWVudC5maW5kT25lKHsgbmlmIH0pXG4gICAgICAgIFxuICAgICAgICBpZihfZXN0YWJsaXNobWVudCkgdGhyb3cgbmV3IER1cGxpY2l0eUVycm9yKGB1c2VyIHdpdGggbmlmICR7bmlmfSBhbHJlYWR5IGV4aXN0c2ApXG5cbiAgICAgICAgY29uc3QgaGFzaCA9IGF3YWl0IGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMClcblxuICAgICAgICBhd2FpdCBFc3RhYmxpc2htZW50LmNyZWF0ZSh7IGVzdGFibGlzaG1lbnQsIG5pZiwgc3RhZmY6IFt7ZW1haWwsIHJvbGU6ICdvd25lcicsIHBhc3N3b3JkOiBoYXNofV19KVxuXG4gICAgICAgIHJldHVyblxuICAgIH0pKClcbn0iXX0=