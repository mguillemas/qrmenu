function cov_k98jpmq72(){var path="/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/register-worker.spec.js";var hash="81e2f4015b007518577a97fef4fceb0569422f23";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/register-worker.spec.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:26}},"1":{start:{line:2,column:47},end:{line:2,column:54}},"2":{start:{line:3,column:46},end:{line:3,column:68}},"3":{start:{line:4,column:23},end:{line:4,column:51}},"4":{start:{line:5,column:17},end:{line:5,column:21}},"5":{start:{line:6,column:15},end:{line:6,column:34}},"6":{start:{line:7,column:17},end:{line:7,column:32}},"7":{start:{line:8,column:46},end:{line:8,column:71}},"8":{start:{line:9,column:29},end:{line:9,column:61}},"9":{start:{line:11,column:0},end:{line:84,column:2}},"10":{start:{line:12,column:4},end:{line:15,column:7}},"11":{start:{line:13,column:8},end:{line:13,column:43}},"12":{start:{line:14,column:8},end:{line:14,column:40}},"13":{start:{line:19,column:4},end:{line:28,column:6}},"14":{start:{line:20,column:8},end:{line:20,column:51}},"15":{start:{line:21,column:8},end:{line:21,column:28}},"16":{start:{line:22,column:8},end:{line:22,column:40}},"17":{start:{line:23,column:8},end:{line:23,column:40}},"18":{start:{line:25,column:8},end:{line:25,column:43}},"19":{start:{line:26,column:8},end:{line:26,column:21}},"20":{start:{line:27,column:8},end:{line:27,column:42}},"21":{start:{line:30,column:4},end:{line:78,column:6}},"22":{start:{line:31,column:8},end:{line:38,column:10}},"23":{start:{line:32,column:25},end:{line:32,column:56}},"24":{start:{line:33,column:36},end:{line:33,column:133}},"25":{start:{line:35,column:12},end:{line:35,column:47}},"26":{start:{line:36,column:12},end:{line:36,column:49}},"27":{start:{line:41,column:8},end:{line:64,column:10}},"28":{start:{line:42,column:12},end:{line:42,column:86}},"29":{start:{line:44,column:28},end:{line:44,column:73}},"30":{start:{line:47,column:27},end:{line:47,column:102}},"31":{start:{line:47,column:49},end:{line:47,column:101}},"32":{start:{line:50,column:12},end:{line:50,column:41}},"33":{start:{line:51,column:12},end:{line:51,column:50}},"34":{start:{line:52,column:12},end:{line:52,column:51}},"35":{start:{line:53,column:12},end:{line:53,column:40}},"36":{start:{line:54,column:12},end:{line:54,column:49}},"37":{start:{line:55,column:12},end:{line:55,column:46}},"38":{start:{line:57,column:26},end:{line:57,column:74}},"39":{start:{line:59,column:12},end:{line:59,column:44}},"40":{start:{line:60,column:12},end:{line:60,column:53}},"41":{start:{line:61,column:12},end:{line:61,column:34}},"42":{start:{line:62,column:12},end:{line:62,column:36}},"43":{start:{line:67,column:8},end:{line:77,column:10}},"44":{start:{line:68,column:12},end:{line:76,column:13}},"45":{start:{line:69,column:16},end:{line:69,column:101}},"46":{start:{line:70,column:16},end:{line:70,column:62}},"47":{start:{line:73,column:16},end:{line:73,column:38}},"48":{start:{line:74,column:16},end:{line:74,column:67}},"49":{start:{line:75,column:16},end:{line:75,column:111}},"50":{start:{line:80,column:4},end:{line:83,column:6}},"51":{start:{line:81,column:8},end:{line:81,column:40}},"52":{start:{line:82,column:8},end:{line:82,column:35}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:11,column:41},end:{line:11,column:42}},loc:{start:{line:11,column:47},end:{line:84,column:1}},line:11},"1":{name:"(anonymous_1)",decl:{start:{line:12,column:11},end:{line:12,column:12}},loc:{start:{line:12,column:22},end:{line:15,column:6}},line:12},"2":{name:"(anonymous_2)",decl:{start:{line:19,column:15},end:{line:19,column:16}},loc:{start:{line:19,column:19},end:{line:28,column:5}},line:19},"3":{name:"(anonymous_3)",decl:{start:{line:30,column:46},end:{line:30,column:47}},loc:{start:{line:30,column:50},end:{line:78,column:5}},line:30},"4":{name:"(anonymous_4)",decl:{start:{line:31,column:19},end:{line:31,column:20}},loc:{start:{line:31,column:30},end:{line:38,column:9}},line:31},"5":{name:"(anonymous_5)",decl:{start:{line:41,column:47},end:{line:41,column:48}},loc:{start:{line:41,column:58},end:{line:64,column:9}},line:41},"6":{name:"(anonymous_6)",decl:{start:{line:47,column:38},end:{line:47,column:39}},loc:{start:{line:47,column:49},end:{line:47,column:101}},line:47},"7":{name:"(anonymous_7)",decl:{start:{line:67,column:52},end:{line:67,column:53}},loc:{start:{line:67,column:63},end:{line:77,column:9}},line:67},"8":{name:"(anonymous_8)",decl:{start:{line:80,column:10},end:{line:80,column:11}},loc:{start:{line:80,column:21},end:{line:83,column:5}},line:80}},branchMap:{"0":{loc:{start:{line:47,column:49},end:{line:47,column:101}},type:"binary-expr",locations:[{start:{line:47,column:49},end:{line:47,column:75}},{start:{line:47,column:80},end:{line:47,column:101}}],line:47}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"81e2f4015b007518577a97fef4fceb0569422f23"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_k98jpmq72=function(){return actualCoverage;};}return actualCoverage;}cov_k98jpmq72();cov_k98jpmq72().s[0]++;require('dotenv').config();const{env:{TEST_MONGODB_URL:MONGODB_URL}}=(cov_k98jpmq72().s[1]++,process);const{mongoose,models:{Establishment}}=(cov_k98jpmq72().s[2]++,require('qrmenu-data'));const registerWorker=(cov_k98jpmq72().s[3]++,require('./register-worker'));const{random}=(cov_k98jpmq72().s[4]++,Math);const bcrypt=(cov_k98jpmq72().s[5]++,require('bcryptjs'));const{expect}=(cov_k98jpmq72().s[6]++,require('chai'));const{utils:{generateNIF:{generateNIF}}}=(cov_k98jpmq72().s[7]++,require('qrmenu-commons'));const{UnexistenceError}=(cov_k98jpmq72().s[8]++,require('qrmenu-commons/errors'));cov_k98jpmq72().s[9]++;describe('server-logic register worker',()=>{cov_k98jpmq72().f[0]++;cov_k98jpmq72().s[10]++;before(async()=>{cov_k98jpmq72().f[1]++;cov_k98jpmq72().s[11]++;await mongoose.connect(MONGODB_URL);cov_k98jpmq72().s[12]++;await Establishment.deleteMany();});let establishment,nif,email,password,newEmail,role,_password,establishmentId,workerId;cov_k98jpmq72().s[13]++;beforeEach(()=>{cov_k98jpmq72().f[2]++;cov_k98jpmq72().s[14]++;establishment=`establishment-${random()}`;cov_k98jpmq72().s[15]++;nif=generateNIF();cov_k98jpmq72().s[16]++;email=`e-${random()}@mail.com`;cov_k98jpmq72().s[17]++;password=`password${random()}`;cov_k98jpmq72().s[18]++;newEmail=`e-${random()}@mail.com`;cov_k98jpmq72().s[19]++;role='chef';cov_k98jpmq72().s[20]++;_password=`password-${random()}`;});cov_k98jpmq72().s[21]++;describe('when the establishment exists',()=>{cov_k98jpmq72().f[3]++;cov_k98jpmq72().s[22]++;beforeEach(async()=>{cov_k98jpmq72().f[4]++;const hash=(cov_k98jpmq72().s[23]++,await bcrypt.hash(password,10));const _establishment=(cov_k98jpmq72().s[24]++,await Establishment.create({establishment,nif,staff:[{email,role:'owner',password:hash}]}));cov_k98jpmq72().s[25]++;establishmentId=_establishment.id;cov_k98jpmq72().s[26]++;workerId=_establishment.staff[0].id;});cov_k98jpmq72().s[27]++;it('should succed on register worker',async()=>{cov_k98jpmq72().f[5]++;cov_k98jpmq72().s[28]++;await registerWorker(establishmentId,workerId,newEmail,role,_password);const{staff}=(cov_k98jpmq72().s[29]++,await Establishment.findById(establishmentId));const worker=(cov_k98jpmq72().s[30]++,staff.find(_worker=>{cov_k98jpmq72().f[6]++;cov_k98jpmq72().s[31]++;return(cov_k98jpmq72().b[0][0]++,_worker.email===newEmail)&&(cov_k98jpmq72().b[0][1]++,_worker.role===role);}));cov_k98jpmq72().s[32]++;expect(worker.email).to.exist;cov_k98jpmq72().s[33]++;expect(worker.email).to.be.a('string');cov_k98jpmq72().s[34]++;expect(worker.email).to.equal(newEmail);cov_k98jpmq72().s[35]++;expect(worker.role).to.exist;cov_k98jpmq72().s[36]++;expect(worker.role).to.be.a('string');cov_k98jpmq72().s[37]++;expect(worker.role).to.equal(role);const match=(cov_k98jpmq72().s[38]++,await bcrypt.compare(_password,worker.password));cov_k98jpmq72().s[39]++;expect(worker.password).to.exist;cov_k98jpmq72().s[40]++;expect(worker.password).to.be.a('string');cov_k98jpmq72().s[41]++;expect(match).to.exist;cov_k98jpmq72().s[42]++;expect(match).to.be.true;});cov_k98jpmq72().s[43]++;it('should fail on wrong establishment id',async()=>{cov_k98jpmq72().f[7]++;cov_k98jpmq72().s[44]++;try{cov_k98jpmq72().s[45]++;await registerWorker("5eedfc3256012e6c3dbb7cbe",workerId,newEmail,role,_password);cov_k98jpmq72().s[46]++;throw new Error('Should not reach this point');}catch(error){cov_k98jpmq72().s[47]++;expect(error).to.exist;cov_k98jpmq72().s[48]++;expect(error).to.be.an.instanceOf(UnexistenceError);cov_k98jpmq72().s[49]++;expect(error.message).to.equal("Establishment with id 5eedfc3256012e6c3dbb7cbe does not exist");}});});cov_k98jpmq72().s[50]++;after(async()=>{cov_k98jpmq72().f[8]++;cov_k98jpmq72().s[51]++;await Establishment.deleteMany();cov_k98jpmq72().s[52]++;await mongoose.disconnect();});});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZ2lzdGVyLXdvcmtlci5zcGVjLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJjb25maWciLCJlbnYiLCJURVNUX01PTkdPREJfVVJMIiwiTU9OR09EQl9VUkwiLCJwcm9jZXNzIiwibW9uZ29vc2UiLCJtb2RlbHMiLCJFc3RhYmxpc2htZW50IiwicmVnaXN0ZXJXb3JrZXIiLCJyYW5kb20iLCJNYXRoIiwiYmNyeXB0IiwiZXhwZWN0IiwidXRpbHMiLCJnZW5lcmF0ZU5JRiIsIlVuZXhpc3RlbmNlRXJyb3IiLCJkZXNjcmliZSIsImJlZm9yZSIsImNvbm5lY3QiLCJkZWxldGVNYW55IiwiZXN0YWJsaXNobWVudCIsIm5pZiIsImVtYWlsIiwicGFzc3dvcmQiLCJuZXdFbWFpbCIsInJvbGUiLCJfcGFzc3dvcmQiLCJlc3RhYmxpc2htZW50SWQiLCJ3b3JrZXJJZCIsImJlZm9yZUVhY2giLCJoYXNoIiwiX2VzdGFibGlzaG1lbnQiLCJjcmVhdGUiLCJzdGFmZiIsImlkIiwiaXQiLCJmaW5kQnlJZCIsIndvcmtlciIsImZpbmQiLCJfd29ya2VyIiwidG8iLCJleGlzdCIsImJlIiwiYSIsImVxdWFsIiwibWF0Y2giLCJjb21wYXJlIiwidHJ1ZSIsIkVycm9yIiwiZXJyb3IiLCJhbiIsImluc3RhbmNlT2YiLCJtZXNzYWdlIiwiYWZ0ZXIiLCJkaXNjb25uZWN0Il0sIm1hcHBpbmdzIjoicWlMQWVZO2dIQWZaQSxPQUFPLENBQUMsUUFBRCxDQUFQLENBQWtCQyxNQUFsQixHQUNBLEtBQU0sQ0FBQ0MsR0FBRyxDQUFFLENBQUNDLGdCQUFnQixDQUFFQyxXQUFuQixDQUFOLDBCQUF5Q0MsT0FBekMsQ0FBTixDQUNBLEtBQU0sQ0FBRUMsUUFBRixDQUFZQyxNQUFNLENBQUUsQ0FBQ0MsYUFBRCxDQUFwQiwwQkFBd0NSLE9BQU8sQ0FBQyxhQUFELENBQS9DLENBQU4sQ0FDQSxLQUFNUyxDQUFBQSxjQUFjLHlCQUFHVCxPQUFPLENBQUMsbUJBQUQsQ0FBVixDQUFwQixD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QWpCLENBQW9CSyxJQUFwQixDQUVILENBdkJDLENBQUYsQ0FYMEMsd0JBcUMxQ1osRUFBRSxDQUFDLHVDQUFELENBQTBDLFNBQVcsZ0RBQ25ELEdBQUkseUJBQ0EsS0FBTTNCLENBQUFBLGNBQWMsQ0FBQywwQkFBRCxDQUE2Qm9CLFFBQTdCLENBQXVDSixRQUF2QyxDQUFpREMsSUFBakQsQ0FBdURDLFNBQXZELENBQXBCLENBREEsd0JBRUEsS0FBTSxJQUFJc0IsQ0FBQUEsS0FBSixDQUFVLDZCQUFWLENBQU4sQ0FDSCxDQUFDLE1BQU9DLEtBQVAsQ0FBYyx5QkFFWnJDLE1BQU0sQ0FBQ3FDLEtBQUQsQ0FBTixDQUFjVCxFQUFkLENBQWlCQyxLQUFqQixDQUZZLHdCQUdaN0IsTUFBTSxDQUFDcUMsS0FBRCxDQUFOLENBQWNULEVBQWQsQ0FBaUJFLEVBQWpCLENBQW9CUSxFQUFwQixDQUF1QkMsVUFBdkIsQ0FBa0NwQyxnQkFBbEMsRUFIWSx3QkFJWkgsTUFBTSxDQUFDcUMsS0FBSyxDQUFDRyxPQUFQLENBQU4sQ0FBc0JaLEVBQXRCLENBQXlCSSxLQUF6QixDQUErQiwrREFBL0IsRUFDSCxDQUNKLENBVkMsQ0FBRixDQVdILENBaERPLENBQVIsQ0FuQjJDLHdCQXFFM0NTLEtBQUssQ0FBQyxTQUFXLGdEQUNiLEtBQU05QyxDQUFBQSxhQUFhLENBQUNZLFVBQWQsRUFBTixDQURhLHdCQUViLEtBQU1kLENBQUFBLFFBQVEsQ0FBQ2lELFVBQVQsRUFBTixDQUNILENBSEksQ0FBTCxDQUlILENBekVPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCdkb3RlbnYnKS5jb25maWcoKVxuY29uc3Qge2Vudjoge1RFU1RfTU9OR09EQl9VUkw6IE1PTkdPREJfVVJMfX0gPSBwcm9jZXNzXG5jb25zdCB7IG1vbmdvb3NlLCBtb2RlbHM6IHtFc3RhYmxpc2htZW50fSB9ID0gcmVxdWlyZSgncXJtZW51LWRhdGEnKVxuY29uc3QgcmVnaXN0ZXJXb3JrZXIgPSByZXF1aXJlKCcuL3JlZ2lzdGVyLXdvcmtlcicpXG5jb25zdCB7cmFuZG9tfSA9IE1hdGhcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcbmNvbnN0IHtleHBlY3R9ID0gcmVxdWlyZSgnY2hhaScpXG5jb25zdCB7dXRpbHM6IHtnZW5lcmF0ZU5JRjoge2dlbmVyYXRlTklGfX19ID0gcmVxdWlyZSgncXJtZW51LWNvbW1vbnMnKVxuY29uc3QgeyBVbmV4aXN0ZW5jZUVycm9yIH0gPSByZXF1aXJlKCdxcm1lbnUtY29tbW9ucy9lcnJvcnMnKVxuXG5kZXNjcmliZSgnc2VydmVyLWxvZ2ljIHJlZ2lzdGVyIHdvcmtlcicsICgpID0+IHtcbiAgICBiZWZvcmUoYXN5bmMoKSA9PiB7XG4gICAgICAgIGF3YWl0IG1vbmdvb3NlLmNvbm5lY3QoTU9OR09EQl9VUkwpXG4gICAgICAgIGF3YWl0IEVzdGFibGlzaG1lbnQuZGVsZXRlTWFueSgpXG4gICAgIH0pXG5cbiAgICBsZXQgZXN0YWJsaXNobWVudCwgbmlmLCBlbWFpbCwgcGFzc3dvcmQsIG5ld0VtYWlsLCByb2xlLCBfcGFzc3dvcmQsIGVzdGFibGlzaG1lbnRJZCwgd29ya2VySWRcblxuICAgIGJlZm9yZUVhY2goKCk9PntcbiAgICAgICAgZXN0YWJsaXNobWVudCA9IGBlc3RhYmxpc2htZW50LSR7cmFuZG9tKCl9YFxuICAgICAgICBuaWYgPSAgZ2VuZXJhdGVOSUYoKVxuICAgICAgICBlbWFpbCA9IGBlLSR7cmFuZG9tKCl9QG1haWwuY29tYFxuICAgICAgICBwYXNzd29yZCA9IGBwYXNzd29yZCR7cmFuZG9tKCl9YFxuXG4gICAgICAgIG5ld0VtYWlsID0gYGUtJHtyYW5kb20oKX1AbWFpbC5jb21gXG4gICAgICAgIHJvbGUgPSAnY2hlZidcbiAgICAgICAgX3Bhc3N3b3JkID0gYHBhc3N3b3JkLSR7cmFuZG9tKCl9YFxuICAgIH0pXG5cbiAgICBkZXNjcmliZSgnd2hlbiB0aGUgZXN0YWJsaXNobWVudCBleGlzdHMnLCAoKT0+e1xuICAgICAgICBiZWZvcmVFYWNoKGFzeW5jKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaGFzaCA9IGF3YWl0IGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMClcbiAgICAgICAgICAgIGNvbnN0IF9lc3RhYmxpc2htZW50ID0gIGF3YWl0IEVzdGFibGlzaG1lbnQuY3JlYXRlKHtlc3RhYmxpc2htZW50LCBuaWYsIHN0YWZmOiBbe2VtYWlsLCByb2xlOiAnb3duZXInLCBwYXNzd29yZDogaGFzaH1dfSlcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICBlc3RhYmxpc2htZW50SWQgPSBfZXN0YWJsaXNobWVudC5pZFxuICAgICAgICAgICAgd29ya2VySWQgPSBfZXN0YWJsaXNobWVudC5zdGFmZlswXS5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgIH0pXG4gICAgICAgIFxuICAgICAgICBcbiAgICAgICAgaXQoJ3Nob3VsZCBzdWNjZWQgb24gcmVnaXN0ZXIgd29ya2VyJywgYXN5bmMoKSA9PiB7IFxuICAgICAgICAgICAgYXdhaXQgcmVnaXN0ZXJXb3JrZXIoZXN0YWJsaXNobWVudElkLCB3b3JrZXJJZCwgbmV3RW1haWwsIHJvbGUsIF9wYXNzd29yZClcbiAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3Qge3N0YWZmfSA9IGF3YWl0IEVzdGFibGlzaG1lbnQuZmluZEJ5SWQoZXN0YWJsaXNobWVudElkKVxuICAgICAgICAgICAgICAgXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHdvcmtlciA9IHN0YWZmLmZpbmQoX3dvcmtlciA9PiBfd29ya2VyLmVtYWlsID09PSBuZXdFbWFpbCAmJiAgX3dvcmtlci5yb2xlID09PSByb2xlKVxuICBcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdCh3b3JrZXIuZW1haWwpLnRvLmV4aXN0XG4gICAgICAgICAgICBleHBlY3Qod29ya2VyLmVtYWlsKS50by5iZS5hKCdzdHJpbmcnKVxuICAgICAgICAgICAgZXhwZWN0KHdvcmtlci5lbWFpbCkudG8uZXF1YWwobmV3RW1haWwpXG4gICAgICAgICAgICBleHBlY3Qod29ya2VyLnJvbGUpLnRvLmV4aXN0XG4gICAgICAgICAgICBleHBlY3Qod29ya2VyLnJvbGUpLnRvLmJlLmEoJ3N0cmluZycpXG4gICAgICAgICAgICBleHBlY3Qod29ya2VyLnJvbGUpLnRvLmVxdWFsKHJvbGUpXG5cbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUoX3Bhc3N3b3JkLCB3b3JrZXIucGFzc3dvcmQpXG4gICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3Qod29ya2VyLnBhc3N3b3JkKS50by5leGlzdFxuICAgICAgICAgICAgZXhwZWN0KHdvcmtlci5wYXNzd29yZCkudG8uYmUuYSgnc3RyaW5nJylcbiAgICAgICAgICAgIGV4cGVjdChtYXRjaCkudG8uZXhpc3RcbiAgICAgICAgICAgIGV4cGVjdChtYXRjaCkudG8uYmUudHJ1ZVxuICAgICAgICAgICAgICAgXG4gICAgICAgIH0pXG5cblxuICAgICAgICBpdCgnc2hvdWxkIGZhaWwgb24gd3JvbmcgZXN0YWJsaXNobWVudCBpZCcsIGFzeW5jKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCByZWdpc3RlcldvcmtlcihcIjVlZWRmYzMyNTYwMTJlNmMzZGJiN2NiZVwiLCB3b3JrZXJJZCwgbmV3RW1haWwsIHJvbGUsIF9wYXNzd29yZClcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Nob3VsZCBub3QgcmVhY2ggdGhpcyBwb2ludCcpXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGV4cGVjdChlcnJvcikudG8uZXhpc3RcbiAgICAgICAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvLmJlLmFuLmluc3RhbmNlT2YoVW5leGlzdGVuY2VFcnJvcilcbiAgICAgICAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG8uZXF1YWwoXCJFc3RhYmxpc2htZW50IHdpdGggaWQgNWVlZGZjMzI1NjAxMmU2YzNkYmI3Y2JlIGRvZXMgbm90IGV4aXN0XCIpXG4gICAgICAgICAgICB9ICAgICAgICAgIFxuICAgICAgICB9KVxuICAgIH0pXG5cbiAgICBhZnRlcihhc3luYygpID0+IHtcbiAgICAgICAgYXdhaXQgRXN0YWJsaXNobWVudC5kZWxldGVNYW55KClcbiAgICAgICAgYXdhaXQgbW9uZ29vc2UuZGlzY29ubmVjdCgpXG4gICAgfSlcbn0pIl19