function cov_k98jpmq72(){var path="/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/register-worker.spec.js";var hash="b10b61378f1eacb55fb607cf4b74e4bb198f42ec";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/register-worker.spec.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:26}},"1":{start:{line:2,column:47},end:{line:2,column:54}},"2":{start:{line:3,column:46},end:{line:3,column:68}},"3":{start:{line:4,column:23},end:{line:4,column:51}},"4":{start:{line:5,column:17},end:{line:5,column:21}},"5":{start:{line:6,column:15},end:{line:6,column:34}},"6":{start:{line:7,column:17},end:{line:7,column:32}},"7":{start:{line:8,column:46},end:{line:8,column:71}},"8":{start:{line:10,column:0},end:{line:88,column:2}},"9":{start:{line:11,column:4},end:{line:11,column:85}},"10":{start:{line:11,column:17},end:{line:11,column:84}},"11":{start:{line:11,column:57},end:{line:11,column:83}},"12":{start:{line:15,column:4},end:{line:24,column:6}},"13":{start:{line:16,column:8},end:{line:16,column:51}},"14":{start:{line:17,column:8},end:{line:17,column:28}},"15":{start:{line:18,column:8},end:{line:18,column:40}},"16":{start:{line:19,column:8},end:{line:19,column:40}},"17":{start:{line:21,column:8},end:{line:21,column:43}},"18":{start:{line:22,column:8},end:{line:22,column:21}},"19":{start:{line:23,column:8},end:{line:23,column:42}},"20":{start:{line:26,column:4},end:{line:85,column:6}},"21":{start:{line:27,column:8},end:{line:34,column:9}},"22":{start:{line:28,column:12},end:{line:33,column:22}},"23":{start:{line:29,column:35},end:{line:29,column:126}},"24":{start:{line:31,column:24},end:{line:31,column:59}},"25":{start:{line:32,column:24},end:{line:32,column:61}},"26":{start:{line:37,column:8},end:{line:84,column:10}},"27":{start:{line:38,column:12},end:{line:38,column:86}},"28":{start:{line:64,column:28},end:{line:64,column:73}},"29":{start:{line:67,column:27},end:{line:67,column:102}},"30":{start:{line:67,column:49},end:{line:67,column:101}},"31":{start:{line:70,column:12},end:{line:70,column:41}},"32":{start:{line:71,column:12},end:{line:71,column:50}},"33":{start:{line:72,column:12},end:{line:72,column:51}},"34":{start:{line:73,column:12},end:{line:73,column:40}},"35":{start:{line:74,column:12},end:{line:74,column:49}},"36":{start:{line:75,column:12},end:{line:75,column:46}},"37":{start:{line:77,column:26},end:{line:77,column:74}},"38":{start:{line:79,column:12},end:{line:79,column:44}},"39":{start:{line:80,column:12},end:{line:80,column:53}},"40":{start:{line:81,column:12},end:{line:81,column:34}},"41":{start:{line:82,column:12},end:{line:82,column:36}},"42":{start:{line:87,column:4},end:{line:87,column:77}},"43":{start:{line:87,column:16},end:{line:87,column:76}},"44":{start:{line:87,column:49},end:{line:87,column:75}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:10,column:41},end:{line:10,column:42}},loc:{start:{line:10,column:47},end:{line:88,column:1}},line:10},"1":{name:"(anonymous_1)",decl:{start:{line:11,column:11},end:{line:11,column:12}},loc:{start:{line:11,column:17},end:{line:11,column:84}},line:11},"2":{name:"(anonymous_2)",decl:{start:{line:11,column:52},end:{line:11,column:53}},loc:{start:{line:11,column:57},end:{line:11,column:83}},line:11},"3":{name:"(anonymous_3)",decl:{start:{line:15,column:15},end:{line:15,column:16}},loc:{start:{line:15,column:19},end:{line:24,column:5}},line:15},"4":{name:"(anonymous_4)",decl:{start:{line:26,column:46},end:{line:26,column:47}},loc:{start:{line:26,column:50},end:{line:85,column:5}},line:26},"5":{name:"(anonymous_5)",decl:{start:{line:27,column:19},end:{line:27,column:20}},loc:{start:{line:28,column:12},end:{line:33,column:22}},line:28},"6":{name:"(anonymous_6)",decl:{start:{line:29,column:26},end:{line:29,column:27}},loc:{start:{line:29,column:35},end:{line:29,column:126}},line:29},"7":{name:"(anonymous_7)",decl:{start:{line:30,column:26},end:{line:30,column:27}},loc:{start:{line:30,column:44},end:{line:33,column:21}},line:30},"8":{name:"(anonymous_8)",decl:{start:{line:37,column:47},end:{line:37,column:48}},loc:{start:{line:37,column:58},end:{line:84,column:9}},line:37},"9":{name:"(anonymous_9)",decl:{start:{line:67,column:38},end:{line:67,column:39}},loc:{start:{line:67,column:49},end:{line:67,column:101}},line:67},"10":{name:"(anonymous_10)",decl:{start:{line:87,column:10},end:{line:87,column:11}},loc:{start:{line:87,column:16},end:{line:87,column:76}},line:87},"11":{name:"(anonymous_11)",decl:{start:{line:87,column:43},end:{line:87,column:44}},loc:{start:{line:87,column:49},end:{line:87,column:75}},line:87}},branchMap:{"0":{loc:{start:{line:67,column:49},end:{line:67,column:101}},type:"binary-expr",locations:[{start:{line:67,column:49},end:{line:67,column:75}},{start:{line:67,column:80},end:{line:67,column:101}}],line:67}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"b10b61378f1eacb55fb607cf4b74e4bb198f42ec"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_k98jpmq72=function(){return actualCoverage;};}return actualCoverage;}cov_k98jpmq72();cov_k98jpmq72().s[0]++;require('dotenv').config();const{env:{TEST_MONGODB_URL:MONGODB_URL}}=(cov_k98jpmq72().s[1]++,process);const{mongoose,models:{Establishment}}=(cov_k98jpmq72().s[2]++,require('qrmenu-data'));const registerWorker=(cov_k98jpmq72().s[3]++,require('./register-worker'));const{random}=(cov_k98jpmq72().s[4]++,Math);const bcrypt=(cov_k98jpmq72().s[5]++,require('bcryptjs'));const{expect}=(cov_k98jpmq72().s[6]++,require('chai'));const{utils:{generateNIF:{generateNIF}}}=(cov_k98jpmq72().s[7]++,require('qrmenu-commons'));cov_k98jpmq72().s[8]++;describe('server-logic register worker',()=>{cov_k98jpmq72().f[0]++;cov_k98jpmq72().s[9]++;before(()=>{cov_k98jpmq72().f[1]++;cov_k98jpmq72().s[10]++;return mongoose.connect(MONGODB_URL).then(()=>{cov_k98jpmq72().f[2]++;cov_k98jpmq72().s[11]++;return Establishment.deleteMany();});});let establishment,nif,email,password,newEmail,role,_password,establishmentId,workerId;cov_k98jpmq72().s[12]++;beforeEach(()=>{cov_k98jpmq72().f[3]++;cov_k98jpmq72().s[13]++;establishment=`establishment-${random()}`;cov_k98jpmq72().s[14]++;nif=generateNIF();cov_k98jpmq72().s[15]++;email=`e-${random()}@mail.com`;cov_k98jpmq72().s[16]++;password=`password${random()}`;cov_k98jpmq72().s[17]++;newEmail=`e-${random()}@mail.com`;cov_k98jpmq72().s[18]++;role='chef';cov_k98jpmq72().s[19]++;_password=`password-${random()}`;});cov_k98jpmq72().s[20]++;describe('when the establishment exists',()=>{cov_k98jpmq72().f[4]++;cov_k98jpmq72().s[21]++;beforeEach(()=>{cov_k98jpmq72().f[5]++;cov_k98jpmq72().s[22]++;return bcrypt.hash(password,10).then(hash=>{cov_k98jpmq72().f[6]++;cov_k98jpmq72().s[23]++;return Establishment.create({establishment,nif,staff:[{email,role:'owner',password:hash}]});}).then(_establishment=>{cov_k98jpmq72().f[7]++;cov_k98jpmq72().s[24]++;establishmentId=_establishment.id;cov_k98jpmq72().s[25]++;workerId=_establishment.staff[0].id;});});cov_k98jpmq72().s[26]++;it('should succed on register worker',async()=>{cov_k98jpmq72().f[8]++;cov_k98jpmq72().s[27]++;await registerWorker(establishmentId,workerId,newEmail,role,_password);// .then(() => {debugger
//     return Establishment.findById(establishmentId)
// })
// .then(({staff}) => {debugger
//     return staff.find(_worker => _worker.email === newEmail &&  _worker.role === role)
// })
// .then(worker => {
//     debugger
//     expect(worker.email).to.exist
//     expect(worker.email).to.be.a('string')
//     expect(worker.email).to.equal(newEmail)
//     expect(worker.role).to.exist
//     expect(worker.role).to.be.a('string')
//     expect(worker.role).to.equal(role)
//     return bcrypt.compare(_password, worker.password)
//         .then(match => {
//             expect(worker.password).to.exist
//             expect(worker.password).to.be.a('string')
//             expect(match).to.exist
//             expect(match).to.be.true
//         })
// })
const{staff}=(cov_k98jpmq72().s[28]++,await Establishment.findById(establishmentId));const worker=(cov_k98jpmq72().s[29]++,staff.find(_worker=>{cov_k98jpmq72().f[9]++;cov_k98jpmq72().s[30]++;return(cov_k98jpmq72().b[0][0]++,_worker.email===newEmail)&&(cov_k98jpmq72().b[0][1]++,_worker.role===role);}));cov_k98jpmq72().s[31]++;expect(worker.email).to.exist;cov_k98jpmq72().s[32]++;expect(worker.email).to.be.a('string');cov_k98jpmq72().s[33]++;expect(worker.email).to.equal(newEmail);cov_k98jpmq72().s[34]++;expect(worker.role).to.exist;cov_k98jpmq72().s[35]++;expect(worker.role).to.be.a('string');cov_k98jpmq72().s[36]++;expect(worker.role).to.equal(role);const match=(cov_k98jpmq72().s[37]++,await bcrypt.compare(_password,worker.password));cov_k98jpmq72().s[38]++;expect(worker.password).to.exist;cov_k98jpmq72().s[39]++;expect(worker.password).to.be.a('string');cov_k98jpmq72().s[40]++;expect(match).to.exist;cov_k98jpmq72().s[41]++;expect(match).to.be.true;});});cov_k98jpmq72().s[42]++;after(()=>{cov_k98jpmq72().f[10]++;cov_k98jpmq72().s[43]++;return mongoose.disconnect().then(()=>{cov_k98jpmq72().f[11]++;cov_k98jpmq72().s[44]++;return Establishment.deleteMany();});});});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZ2lzdGVyLXdvcmtlci5zcGVjLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJjb25maWciLCJlbnYiLCJURVNUX01PTkdPREJfVVJMIiwiTU9OR09EQl9VUkwiLCJwcm9jZXNzIiwibW9uZ29vc2UiLCJtb2RlbHMiLCJFc3RhYmxpc2htZW50IiwicmVnaXN0ZXJXb3JrZXIiLCJyYW5kb20iLCJNYXRoIiwiYmNyeXB0IiwiZXhwZWN0IiwidXRpbHMiLCJnZW5lcmF0ZU5JRiIsImRlc2NyaWJlIiwiYmVmb3JlIiwiY29ubmVjdCIsInRoZW4iLCJkZWxldGVNYW55IiwiZXN0YWJsaXNobWVudCIsIm5pZiIsImVtYWlsIiwicGFzc3dvcmQiLCJuZXdFbWFpbCIsInJvbGUiLCJfcGFzc3dvcmQiLCJlc3RhYmxpc2htZW50SWQiLCJ3b3JrZXJJZCIsImJlZm9yZUVhY2giLCJoYXNoIiwiY3JlYXRlIiwic3RhZmYiLCJfZXN0YWJsaXNobWVudCIsImlkIiwiaXQiLCJmaW5kQnlJZCIsIndvcmtlciIsImZpbmQiLCJfd29ya2VyIiwidG8iLCJleGlzdCIsImJlIiwiYSIsImVxdWFsIiwibWF0Y2giLCJjb21wYXJlIiwidHJ1ZSIsImFmdGVyIiwiZGlzY29ubmVjdCJdLCJtYXBwaW5ncyI6Im9nTEFlWTtnSEFmWkEsT0FBTyxDQUFDLFFBQUQsQ0FBUCxDQUFrQkMsTUFBbEIsR0FDQSxLQUFNLENBQUNDLEdBQUcsQ0FBRSxDQUFDQyxnQkFBZ0IsQ0FBRUMsV0FBbkIsQ0FBTiwwQkFBeUNDLE9BQXpDLENBQU4sQ0FDQSxLQUFNLENBQUVDLFFBQUYsQ0FBWUMsTUFBTSxDQUFFLENBQUNDLGFBQUQsQ0FBcEIsMEJBQXdDUixPQUFPLENBQUMsYUFBRCxDQUEvQyxDQUFOLENBQ0EsS0FBTVMsQ0FBQUEsY0FBYyx5QkFBR1QsT0FBTyxDQUFDLG1CQUFELENBQVYsQ0FBcEIsQ0FDQSxLQUFNLENBQUNVLE1BQUQsMEJBQVdDLElBQVgsQ0FBTixDQUNBLEtBQU1DLENBQUFBLE1B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QUFkLENBQWlCRSxFQUFqQixDQUFvQkssSUFBcEIsQ0FFSCxDQS9DQyxDQUFGLENBZ0RILENBM0RPLENBQVIsQ0FoQjJDLHdCQTZFM0NDLEtBQUssQ0FBQyxJQUFNLHVEQUFBM0MsQ0FBQUEsUUFBUSxDQUFDNEMsVUFBVCxHQUFzQi9CLElBQXRCLENBQTJCLElBQU0sdURBQUFYLENBQUFBLGFBQWEsQ0FBQ1ksVUFBZCxHQUEwQixDQUEzRCxFQUE0RCxDQUFuRSxDQUFMLENBQ0gsQ0E5RU8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZygpXG5jb25zdCB7ZW52OiB7VEVTVF9NT05HT0RCX1VSTDogTU9OR09EQl9VUkx9fSA9IHByb2Nlc3NcbmNvbnN0IHsgbW9uZ29vc2UsIG1vZGVsczoge0VzdGFibGlzaG1lbnR9IH0gPSByZXF1aXJlKCdxcm1lbnUtZGF0YScpXG5jb25zdCByZWdpc3RlcldvcmtlciA9IHJlcXVpcmUoJy4vcmVnaXN0ZXItd29ya2VyJylcbmNvbnN0IHtyYW5kb219ID0gTWF0aFxuY29uc3QgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0anMnKVxuY29uc3Qge2V4cGVjdH0gPSByZXF1aXJlKCdjaGFpJylcbmNvbnN0IHt1dGlsczoge2dlbmVyYXRlTklGOiB7Z2VuZXJhdGVOSUZ9fX0gPSByZXF1aXJlKCdxcm1lbnUtY29tbW9ucycpXG5cbmRlc2NyaWJlKCdzZXJ2ZXItbG9naWMgcmVnaXN0ZXIgd29ya2VyJywgKCkgPT4ge1xuICAgIGJlZm9yZSgoKSA9PiBtb25nb29zZS5jb25uZWN0KE1PTkdPREJfVVJMKS50aGVuKCgpPT4gRXN0YWJsaXNobWVudC5kZWxldGVNYW55KCkpKVxuXG4gICAgbGV0IGVzdGFibGlzaG1lbnQsIG5pZiwgZW1haWwsIHBhc3N3b3JkLCBuZXdFbWFpbCwgcm9sZSwgX3Bhc3N3b3JkLCBlc3RhYmxpc2htZW50SWQsIHdvcmtlcklkXG5cbiAgICBiZWZvcmVFYWNoKCgpPT57XG4gICAgICAgIGVzdGFibGlzaG1lbnQgPSBgZXN0YWJsaXNobWVudC0ke3JhbmRvbSgpfWBcbiAgICAgICAgbmlmID0gIGdlbmVyYXRlTklGKClcbiAgICAgICAgZW1haWwgPSBgZS0ke3JhbmRvbSgpfUBtYWlsLmNvbWBcbiAgICAgICAgcGFzc3dvcmQgPSBgcGFzc3dvcmQke3JhbmRvbSgpfWBcblxuICAgICAgICBuZXdFbWFpbCA9IGBlLSR7cmFuZG9tKCl9QG1haWwuY29tYFxuICAgICAgICByb2xlID0gJ2NoZWYnXG4gICAgICAgIF9wYXNzd29yZCA9IGBwYXNzd29yZC0ke3JhbmRvbSgpfWBcbiAgICB9KVxuXG4gICAgZGVzY3JpYmUoJ3doZW4gdGhlIGVzdGFibGlzaG1lbnQgZXhpc3RzJywgKCk9PntcbiAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiBcbiAgICAgICAgICAgIGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oaGFzaCA9PiAgRXN0YWJsaXNobWVudC5jcmVhdGUoe2VzdGFibGlzaG1lbnQsIG5pZiwgc3RhZmY6IFt7ZW1haWwsIHJvbGU6ICdvd25lcicsIHBhc3N3b3JkOiBoYXNofV19KSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oX2VzdGFibGlzaG1lbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXN0YWJsaXNobWVudElkID0gX2VzdGFibGlzaG1lbnQuaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtlcklkID0gX2VzdGFibGlzaG1lbnQuc3RhZmZbMF0uaWRcbiAgICAgICAgICAgICAgICAgICAgfSkgICAgICAgICAgICAgICAgXG4gICAgICAgIClcbiAgICAgICAgXG4gICAgICAgIFxuICAgICAgICBpdCgnc2hvdWxkIHN1Y2NlZCBvbiByZWdpc3RlciB3b3JrZXInLCBhc3luYygpID0+IHsgXG4gICAgICAgICAgICBhd2FpdCByZWdpc3Rlcldvcmtlcihlc3RhYmxpc2htZW50SWQsIHdvcmtlcklkLCBuZXdFbWFpbCwgcm9sZSwgX3Bhc3N3b3JkKVxuICAgICAgICAgICAgICAgIC8vIC50aGVuKCgpID0+IHtkZWJ1Z2dlclxuICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gRXN0YWJsaXNobWVudC5maW5kQnlJZChlc3RhYmxpc2htZW50SWQpXG4gICAgICAgICAgICAgICAgLy8gfSlcbiAgICAgICAgICAgICAgICAvLyAudGhlbigoe3N0YWZmfSkgPT4ge2RlYnVnZ2VyXG4gICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiBzdGFmZi5maW5kKF93b3JrZXIgPT4gX3dvcmtlci5lbWFpbCA9PT0gbmV3RW1haWwgJiYgIF93b3JrZXIucm9sZSA9PT0gcm9sZSlcbiAgICAgICAgICAgICAgICAvLyB9KVxuICAgICAgICAgICAgICAgIC8vIC50aGVuKHdvcmtlciA9PiB7XG4gICAgICAgICAgICAgICAgLy8gICAgIGRlYnVnZ2VyXG4gICAgICAgICAgICAgICAgLy8gICAgIGV4cGVjdCh3b3JrZXIuZW1haWwpLnRvLmV4aXN0XG4gICAgICAgICAgICAgICAgLy8gICAgIGV4cGVjdCh3b3JrZXIuZW1haWwpLnRvLmJlLmEoJ3N0cmluZycpXG4gICAgICAgICAgICAgICAgLy8gICAgIGV4cGVjdCh3b3JrZXIuZW1haWwpLnRvLmVxdWFsKG5ld0VtYWlsKVxuICAgICAgICAgICAgICAgIC8vICAgICBleHBlY3Qod29ya2VyLnJvbGUpLnRvLmV4aXN0XG4gICAgICAgICAgICAgICAgLy8gICAgIGV4cGVjdCh3b3JrZXIucm9sZSkudG8uYmUuYSgnc3RyaW5nJylcbiAgICAgICAgICAgICAgICAvLyAgICAgZXhwZWN0KHdvcmtlci5yb2xlKS50by5lcXVhbChyb2xlKVxuXG4gICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiBiY3J5cHQuY29tcGFyZShfcGFzc3dvcmQsIHdvcmtlci5wYXNzd29yZClcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIC50aGVuKG1hdGNoID0+IHtcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICBleHBlY3Qod29ya2VyLnBhc3N3b3JkKS50by5leGlzdFxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIGV4cGVjdCh3b3JrZXIucGFzc3dvcmQpLnRvLmJlLmEoJ3N0cmluZycpXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgZXhwZWN0KG1hdGNoKS50by5leGlzdFxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIGV4cGVjdChtYXRjaCkudG8uYmUudHJ1ZVxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIC8vIH0pXG4gICAgICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHtzdGFmZn0gPSBhd2FpdCBFc3RhYmxpc2htZW50LmZpbmRCeUlkKGVzdGFibGlzaG1lbnRJZClcbiAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCB3b3JrZXIgPSBzdGFmZi5maW5kKF93b3JrZXIgPT4gX3dvcmtlci5lbWFpbCA9PT0gbmV3RW1haWwgJiYgIF93b3JrZXIucm9sZSA9PT0gcm9sZSlcbiAgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3Qod29ya2VyLmVtYWlsKS50by5leGlzdFxuICAgICAgICAgICAgZXhwZWN0KHdvcmtlci5lbWFpbCkudG8uYmUuYSgnc3RyaW5nJylcbiAgICAgICAgICAgIGV4cGVjdCh3b3JrZXIuZW1haWwpLnRvLmVxdWFsKG5ld0VtYWlsKVxuICAgICAgICAgICAgZXhwZWN0KHdvcmtlci5yb2xlKS50by5leGlzdFxuICAgICAgICAgICAgZXhwZWN0KHdvcmtlci5yb2xlKS50by5iZS5hKCdzdHJpbmcnKVxuICAgICAgICAgICAgZXhwZWN0KHdvcmtlci5yb2xlKS50by5lcXVhbChyb2xlKVxuXG4gICAgICAgICAgICBjb25zdCBtYXRjaCA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKF9wYXNzd29yZCwgd29ya2VyLnBhc3N3b3JkKVxuICAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KHdvcmtlci5wYXNzd29yZCkudG8uZXhpc3RcbiAgICAgICAgICAgIGV4cGVjdCh3b3JrZXIucGFzc3dvcmQpLnRvLmJlLmEoJ3N0cmluZycpXG4gICAgICAgICAgICBleHBlY3QobWF0Y2gpLnRvLmV4aXN0XG4gICAgICAgICAgICBleHBlY3QobWF0Y2gpLnRvLmJlLnRydWVcbiAgICAgICAgICAgICAgIFxuICAgICAgICB9KVxuICAgIH0pXG5cbiAgICBhZnRlcigoKSA9PiBtb25nb29zZS5kaXNjb25uZWN0KCkudGhlbigoKSA9PiBFc3RhYmxpc2htZW50LmRlbGV0ZU1hbnkoKSkpXG59KSJdfQ==