function cov_23x1n2e798(){var path="/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/register-establishment.js";var hash="a1a56752667abe1c6df736dec2366656f0846a5c";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/register-establishment.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:42}},"1":{start:{line:2,column:0},end:{line:2,column:40}},"2":{start:{line:3,column:61},end:{line:3,column:86}},"3":{start:{line:4,column:36},end:{line:4,column:58}},"4":{start:{line:5,column:15},end:{line:5,column:34}},"5":{start:{line:15,column:0},end:{line:35,column:1}},"6":{start:{line:16,column:4},end:{line:16,column:42}},"7":{start:{line:17,column:4},end:{line:17,column:32}},"8":{start:{line:18,column:4},end:{line:18,column:21}},"9":{start:{line:19,column:4},end:{line:19,column:34}},"10":{start:{line:20,column:4},end:{line:20,column:25}},"11":{start:{line:21,column:4},end:{line:21,column:37}},"12":{start:{line:23,column:4},end:{line:34,column:8}},"13":{start:{line:25,column:31},end:{line:25,column:67}},"14":{start:{line:27,column:8},end:{line:27,column:90}},"15":{start:{line:27,column:27},end:{line:27,column:90}},"16":{start:{line:29,column:21},end:{line:29,column:52}},"17":{start:{line:31,column:8},end:{line:31,column:106}},"18":{start:{line:33,column:8},end:{line:33,column:14}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:15,column:17},end:{line:15,column:18}},loc:{start:{line:15,column:58},end:{line:35,column:1}},line:15},"1":{name:"(anonymous_1)",decl:{start:{line:23,column:12},end:{line:23,column:13}},loc:{start:{line:23,column:23},end:{line:34,column:5}},line:23}},branchMap:{"0":{loc:{start:{line:27,column:8},end:{line:27,column:90}},type:"if",locations:[{start:{line:27,column:8},end:{line:27,column:90}},{start:{line:27,column:8},end:{line:27,column:90}}],line:27}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0,"1":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"a1a56752667abe1c6df736dec2366656f0846a5c"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_23x1n2e798=function(){return actualCoverage;};}return actualCoverage;}cov_23x1n2e798();cov_23x1n2e798().s[0]++;require('qrmenu-commons/polyfills/string');cov_23x1n2e798().s[1]++;require('qrmenu-commons/polyfills/json');const{utils:{Email,NIF},errors:{DuplicityError}}=(cov_23x1n2e798().s[2]++,require('qrmenu-commons'));const{models:{Establishment}}=(cov_23x1n2e798().s[3]++,require('qrmenu-data'));const bcrypt=(cov_23x1n2e798().s[4]++,require('bcryptjs'));/**
 * 
 * @param {string} establishment name of the establishment
 * @param {string} nif nif of the establishment
 * @param {string} email email of the worker(owner)
 * @param {string} password password of the worker(owner)
 */cov_23x1n2e798().s[5]++;module.exports=(establishment,nif,email,password)=>{cov_23x1n2e798().f[0]++;cov_23x1n2e798().s[6]++;String.validate.notVoid(establishment);cov_23x1n2e798().s[7]++;String.validate.notVoid(nif);cov_23x1n2e798().s[8]++;NIF.validate(nif);cov_23x1n2e798().s[9]++;String.validate.notVoid(email);cov_23x1n2e798().s[10]++;Email.validate(email);cov_23x1n2e798().s[11]++;String.validate.notVoid(password);cov_23x1n2e798().s[12]++;return(async()=>{cov_23x1n2e798().f[1]++;const _establishment=(cov_23x1n2e798().s[13]++,await Establishment.findOne({nif}));cov_23x1n2e798().s[14]++;if(_establishment){cov_23x1n2e798().b[0][0]++;cov_23x1n2e798().s[15]++;throw new DuplicityError(`user with nif ${nif} already exists`);}else{cov_23x1n2e798().b[0][1]++;}const hash=(cov_23x1n2e798().s[16]++,await bcrypt.hash(password,10));cov_23x1n2e798().s[17]++;await Establishment.create({establishment,nif,staff:[{email,role:'owner',password:hash}]});cov_23x1n2e798().s[18]++;return;})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZ2lzdGVyLWVzdGFibGlzaG1lbnQuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsInV0aWxzIiwiRW1haWwiLCJOSUYiLCJlcnJvcnMiLCJEdXBsaWNpdHlFcnJvciIsIm1vZGVscyIsIkVzdGFibGlzaG1lbnQiLCJiY3J5cHQiLCJtb2R1bGUiLCJleHBvcnRzIiwiZXN0YWJsaXNobWVudCIsIm5pZiIsImVtYWlsIiwicGFzc3dvcmQiLCJTdHJpbmciLCJ2YWxpZGF0ZSIsIm5vdFZvaWQiLCJfZXN0YWJsaXNobWVudCIsImZpbmRPbmUiLCJoYXNoIiwiY3JlYXRlIiwic3RhZmYiLCJyb2xlIl0sIm1hcHBpbmdzIjoieTNFQWVZO21IQWZaQSxPQUFPLENBQUMsaUNBQUQsQ0FBUCxDLHdCQUNBQSxPQUFPLENBQUMsK0JBQUQsQ0FBUCxDQUNBLEtBQU0sQ0FBRUMsS0FBSyxDQUFFLENBQUVDLEtBQUYsQ0FBU0MsR0FBVCxDQUFULENBQXlCQyxNQUFNLENBQUUsQ0FBRUMsY0FBRixDQUFqQywyQkFBdURMLE9BQU8sQ0FBQyxnQkFBRCxDQUE5RCxDQUFOLENBQ0EsS0FBTSxDQUFFTSxNQUFNLENBQUUsQ0FBQ0MsYUFBRCxDQUFWLDJCQUE4QlAsT0FBTyxDQUFDLGFBQUQsQ0FBckMsQ0FBTixDQUNBLEtBQU1RLENBQUFBLE1BQU0sMEJBQUdSLE9BQU8sQ0FBQyxVQUFELENBQVYsQ0FBWixDQUVBOzs7Ozs7MkJBUUFTLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixDQUFDQyxhQUFELENBQWdCQyxHQUFoQixDQUFxQkMsS0FBckIsQ0FBNEJDLFFBQTVCLEdBQXlDLGlEQUN0REMsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3Qk4sYUFBeEIsRUFEc0Qsd0JBRXRESSxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLE9BQWhCLENBQXdCTCxHQUF4QixFQUZzRCx3QkFHdERULEdBQUcsQ0FBQ2EsUUFBSixDQUFhSixHQUFiLEVBSHNELHdCQUl0REcsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3QkosS0FBeEIsRUFKc0QseUJBS3REWCxLQUFLLENBQUNjLFFBQU4sQ0FBZUgsS0FBZixFQUxzRCx5QkFNdERFLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0JILFFBQXhCLEVBTnNELHlCQVF0RCxNQUFPLENBQUMsU0FBVyx5QkFFZixLQUFNSSxDQUFBQSxjQUFjLDJCQUFHLEtBQU1YLENBQUFBLGFBQWEsQ0FBQ1ksT0FBZCxDQUFzQixDQUFFUCxHQUFGLENBQXRCLENBQVQsQ0FBcEIsQ0FGZSx5QkFJZixHQUFHTSxjQUFILENBQW1CLDBEQUFNLElBQUliLENBQUFBLGNBQUosQ0FBb0IsaUJBQWdCTyxHQUFJLGlCQUF4QyxDQUFOLENBQStELENBQWxGLGlDQUVBLEtBQU1RLENBQUFBLElBQUksMkJBQUcsS0FBTVosQ0FBQUEsTUFBTSxDQUFDWSxJQUFQLENBQVlOLFFBQVosQ0FBc0IsRUFBdEIsQ0FBVCxDQUFWLENBTmUseUJBUWYsS0FBTVAsQ0FBQUEsYUFBYSxDQUFDYyxNQUFkLENBQXFCLENBQUVWLGFBQUYsQ0FBaUJDLEdBQWpCLENBQXNCVSxLQUFLLENBQUUsQ0FBQyxDQUFDVCxLQUFELENBQVFVLElBQUksQ0FBRSxPQUFkLENBQXVCVCxRQUFRLENBQUVNLElBQWpDLENBQUQsQ0FBN0IsQ0FBckIsQ0FBTixDQVJlLHlCQVVmLE9BQ0gsQ0FYTSxHQUFQLENBWUgsQ0FwQkQiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCdxcm1lbnUtY29tbW9ucy9wb2x5ZmlsbHMvc3RyaW5nJylcbnJlcXVpcmUoJ3FybWVudS1jb21tb25zL3BvbHlmaWxscy9qc29uJylcbmNvbnN0IHsgdXRpbHM6IHsgRW1haWwsIE5JRiB9LCBlcnJvcnM6IHsgRHVwbGljaXR5RXJyb3IgfX0gPSByZXF1aXJlKCdxcm1lbnUtY29tbW9ucycpXG5jb25zdCB7IG1vZGVsczoge0VzdGFibGlzaG1lbnR9IH0gPSByZXF1aXJlKCdxcm1lbnUtZGF0YScpXG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKCdiY3J5cHRqcycpXG5cbi8qKlxuICogXG4gKiBAcGFyYW0ge3N0cmluZ30gZXN0YWJsaXNobWVudCBuYW1lIG9mIHRoZSBlc3RhYmxpc2htZW50XG4gKiBAcGFyYW0ge3N0cmluZ30gbmlmIG5pZiBvZiB0aGUgZXN0YWJsaXNobWVudFxuICogQHBhcmFtIHtzdHJpbmd9IGVtYWlsIGVtYWlsIG9mIHRoZSB3b3JrZXIob3duZXIpXG4gKiBAcGFyYW0ge3N0cmluZ30gcGFzc3dvcmQgcGFzc3dvcmQgb2YgdGhlIHdvcmtlcihvd25lcilcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IChlc3RhYmxpc2htZW50LCBuaWYsIGVtYWlsLCBwYXNzd29yZCkgPT4ge1xuICAgIFN0cmluZy52YWxpZGF0ZS5ub3RWb2lkKGVzdGFibGlzaG1lbnQpXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQobmlmKVxuICAgIE5JRi52YWxpZGF0ZShuaWYpXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQoZW1haWwpXG4gICAgRW1haWwudmFsaWRhdGUoZW1haWwpXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQocGFzc3dvcmQpXG5cbiAgICByZXR1cm4gKGFzeW5jKCkgPT4ge1xuICAgICAgICBcbiAgICAgICAgY29uc3QgX2VzdGFibGlzaG1lbnQgPSBhd2FpdCBFc3RhYmxpc2htZW50LmZpbmRPbmUoeyBuaWYgfSlcbiAgICAgICAgXG4gICAgICAgIGlmKF9lc3RhYmxpc2htZW50KSB0aHJvdyBuZXcgRHVwbGljaXR5RXJyb3IoYHVzZXIgd2l0aCBuaWYgJHtuaWZ9IGFscmVhZHkgZXhpc3RzYClcblxuICAgICAgICBjb25zdCBoYXNoID0gYXdhaXQgYmNyeXB0Lmhhc2gocGFzc3dvcmQsIDEwKVxuXG4gICAgICAgIGF3YWl0IEVzdGFibGlzaG1lbnQuY3JlYXRlKHsgZXN0YWJsaXNobWVudCwgbmlmLCBzdGFmZjogW3tlbWFpbCwgcm9sZTogJ293bmVyJywgcGFzc3dvcmQ6IGhhc2h9XX0pXG5cbiAgICAgICAgcmV0dXJuXG4gICAgfSkoKVxufSJdfQ==