function cov_n7ygh2tkz(){var path="/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/add-dishes-to-order.js";var hash="ea4057b70200b38204793796d3257c9f7eb49943";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/add-dishes-to-order.js",statementMap:{"0":{start:{line:1,column:52},end:{line:1,column:74}},"1":{start:{line:2,column:55},end:{line:2,column:80}},"2":{start:{line:3,column:0},end:{line:3,column:42}},"3":{start:{line:4,column:0},end:{line:4,column:41}},"4":{start:{line:13,column:0},end:{line:56,column:1}},"5":{start:{line:14,column:4},end:{line:14,column:36}},"6":{start:{line:15,column:4},end:{line:15,column:28}},"7":{start:{line:16,column:4},end:{line:16,column:30}},"8":{start:{line:18,column:4},end:{line:55,column:8}},"9":{start:{line:21,column:30},end:{line:21,column:75}},"10":{start:{line:23,column:8},end:{line:23,column:112}},"11":{start:{line:23,column:27},end:{line:23,column:112}},"12":{start:{line:25,column:41},end:{line:25,column:54}},"13":{start:{line:27,column:22},end:{line:27,column:66}},"14":{start:{line:27,column:44},end:{line:27,column:65}},"15":{start:{line:29,column:8},end:{line:29,column:88}},"16":{start:{line:29,column:19},end:{line:29,column:88}},"17":{start:{line:31,column:8},end:{line:31,column:74}},"18":{start:{line:31,column:26},end:{line:31,column:74}},"19":{start:{line:33,column:22},end:{line:33,column:97}},"20":{start:{line:33,column:44},end:{line:33,column:96}},"21":{start:{line:35,column:8},end:{line:35,column:81}},"22":{start:{line:35,column:19},end:{line:35,column:81}},"23":{start:{line:37,column:29},end:{line:37,column:34}},"24":{start:{line:39,column:8},end:{line:50,column:12}},"25":{start:{line:41,column:26},end:{line:41,column:65}},"26":{start:{line:41,column:47},end:{line:41,column:64}},"27":{start:{line:43,column:12},end:{line:43,column:51}},"28":{start:{line:45,column:12},end:{line:45,column:89}},"29":{start:{line:45,column:24},end:{line:45,column:89}},"30":{start:{line:47,column:12},end:{line:49,column:15}},"31":{start:{line:53,column:8},end:{line:53,column:34}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:13,column:17},end:{line:13,column:18}},loc:{start:{line:13,column:59},end:{line:56,column:1}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:18,column:12},end:{line:18,column:13}},loc:{start:{line:18,column:23},end:{line:55,column:5}},line:18},"2":{name:"(anonymous_2)",decl:{start:{line:27,column:34},end:{line:27,column:35}},loc:{start:{line:27,column:44},end:{line:27,column:65}},line:27},"3":{name:"(anonymous_3)",decl:{start:{line:33,column:34},end:{line:33,column:35}},loc:{start:{line:33,column:44},end:{line:33,column:96}},line:33},"4":{name:"(anonymous_4)",decl:{start:{line:39,column:41},end:{line:39,column:42}},loc:{start:{line:39,column:55},end:{line:50,column:9}},line:39},"5":{name:"(anonymous_5)",decl:{start:{line:41,column:38},end:{line:41,column:39}},loc:{start:{line:41,column:47},end:{line:41,column:64}},line:41}},branchMap:{"0":{loc:{start:{line:23,column:8},end:{line:23,column:112}},type:"if",locations:[{start:{line:23,column:8},end:{line:23,column:112}},{start:{line:23,column:8},end:{line:23,column:112}}],line:23},"1":{loc:{start:{line:29,column:8},end:{line:29,column:88}},type:"if",locations:[{start:{line:29,column:8},end:{line:29,column:88}},{start:{line:29,column:8},end:{line:29,column:88}}],line:29},"2":{loc:{start:{line:31,column:8},end:{line:31,column:74}},type:"if",locations:[{start:{line:31,column:8},end:{line:31,column:74}},{start:{line:31,column:8},end:{line:31,column:74}}],line:31},"3":{loc:{start:{line:33,column:44},end:{line:33,column:96}},type:"binary-expr",locations:[{start:{line:33,column:44},end:{line:33,column:70}},{start:{line:33,column:74},end:{line:33,column:96}}],line:33},"4":{loc:{start:{line:35,column:8},end:{line:35,column:81}},type:"if",locations:[{start:{line:35,column:8},end:{line:35,column:81}},{start:{line:35,column:8},end:{line:35,column:81}}],line:35},"5":{loc:{start:{line:45,column:12},end:{line:45,column:89}},type:"if",locations:[{start:{line:45,column:12},end:{line:45,column:89}},{start:{line:45,column:12},end:{line:45,column:89}}],line:45}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"ea4057b70200b38204793796d3257c9f7eb49943"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_n7ygh2tkz=function(){return actualCoverage;};}return actualCoverage;}cov_n7ygh2tkz();const{models:{Establishment,Dish,DishStatus}}=(cov_n7ygh2tkz().s[0]++,require('qrmenu-data'));const{errors:{UnexistenceError,CredentialsError}}=(cov_n7ygh2tkz().s[1]++,require('qrmenu-commons'));cov_n7ygh2tkz().s[2]++;require('qrmenu-commons/polyfills/string');cov_n7ygh2tkz().s[3]++;require('qrmenu-commons/polyfills/array');/**
 * 
 * @param {string} establishmentId id from the establishment
 * @param {string} tableId id from the table
 * @param {array} userDishes array of multiple dishes id's
 */cov_n7ygh2tkz().s[4]++;module.exports=(establishmentId,tableId,userDishes)=>{cov_n7ygh2tkz().f[0]++;cov_n7ygh2tkz().s[5]++;String.validate(establishmentId);cov_n7ygh2tkz().s[6]++;String.validate(tableId);cov_n7ygh2tkz().s[7]++;Array.validate(userDishes);cov_n7ygh2tkz().s[8]++;return(async()=>{cov_n7ygh2tkz().f[1]++;const establishment=(cov_n7ygh2tkz().s[9]++,await Establishment.findById(establishmentId));cov_n7ygh2tkz().s[10]++;if(!establishment){cov_n7ygh2tkz().b[0][0]++;cov_n7ygh2tkz().s[11]++;throw new UnexistenceError(`Establishment with id ${establishmentId} does not exist`);}else{cov_n7ygh2tkz().b[0][1]++;}const{orders,tables,dishes}=(cov_n7ygh2tkz().s[12]++,establishment);const table=(cov_n7ygh2tkz().s[13]++,tables.find(_table=>{cov_n7ygh2tkz().f[2]++;cov_n7ygh2tkz().s[14]++;return _table.id===tableId;}));cov_n7ygh2tkz().s[15]++;if(!table){cov_n7ygh2tkz().b[1][0]++;cov_n7ygh2tkz().s[16]++;throw new UnexistenceError(`Table with id ${tableId} does not exist`);}else{cov_n7ygh2tkz().b[1][1]++;}cov_n7ygh2tkz().s[17]++;if(!table.active){cov_n7ygh2tkz().b[2][0]++;cov_n7ygh2tkz().s[18]++;throw new CredentialsError("Permission denied");}else{cov_n7ygh2tkz().b[2][1]++;}const order=(cov_n7ygh2tkz().s[19]++,orders.find(_order=>{cov_n7ygh2tkz().f[3]++;cov_n7ygh2tkz().s[20]++;return(cov_n7ygh2tkz().b[3][0]++,_order.tableId===tableId)&&(cov_n7ygh2tkz().b[3][1]++,_order.payed===false);}));cov_n7ygh2tkz().s[21]++;if(!order){cov_n7ygh2tkz().b[4][0]++;cov_n7ygh2tkz().s[22]++;throw new UnexistenceError(`No order open with this orderId `);}else{cov_n7ygh2tkz().b[4][1]++;}const{dishStatus}=(cov_n7ygh2tkz().s[23]++,order);cov_n7ygh2tkz().s[24]++;await Promise.all(userDishes.map(async dish=>{cov_n7ygh2tkz().f[4]++;const match=(cov_n7ygh2tkz().s[25]++,dishes.find(_dish=>{cov_n7ygh2tkz().f[5]++;cov_n7ygh2tkz().s[26]++;return _dish.id===dish;}));cov_n7ygh2tkz().s[27]++;order.total=order.total+match.price;cov_n7ygh2tkz().s[28]++;if(!match){cov_n7ygh2tkz().b[5][0]++;cov_n7ygh2tkz().s[29]++;throw new UnexistenceError(`Dish with id ${dish} does not exist`);}else{cov_n7ygh2tkz().b[5][1]++;}cov_n7ygh2tkz().s[30]++;dishStatus.push(new DishStatus({dish}));}));cov_n7ygh2tkz().s[31]++;await establishment.save();})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkZC1kaXNoZXMtdG8tb3JkZXIuanMiXSwibmFtZXMiOlsibW9kZWxzIiwiRXN0YWJsaXNobWVudCIsIkRpc2giLCJEaXNoU3RhdHVzIiwicmVxdWlyZSIsImVycm9ycyIsIlVuZXhpc3RlbmNlRXJyb3IiLCJDcmVkZW50aWFsc0Vycm9yIiwibW9kdWxlIiwiZXhwb3J0cyIsImVzdGFibGlzaG1lbnRJZCIsInRhYmxlSWQiLCJ1c2VyRGlzaGVzIiwiU3RyaW5nIiwidmFsaWRhdGUiLCJBcnJheSIsImVzdGFibGlzaG1lbnQiLCJmaW5kQnlJZCIsIm9yZGVycyIsInRhYmxlcyIsImRpc2hlcyIsInRhYmxlIiwiZmluZCIsIl90YWJsZSIsImlkIiwiYWN0aXZlIiwib3JkZXIiLCJfb3JkZXIiLCJwYXllZCIsImRpc2hTdGF0dXMiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiZGlzaCIsIm1hdGNoIiwiX2Rpc2giLCJ0b3RhbCIsInByaWNlIiwicHVzaCIsInNhdmUiXSwibWFwcGluZ3MiOiJxeUpBZVk7eUZBZlosS0FBTSxDQUFDQSxNQUFNLENBQUUsQ0FBQ0MsYUFBRCxDQUFnQkMsSUFBaEIsQ0FBc0JDLFVBQXRCLENBQVQsMEJBQThDQyxPQUFPLENBQUMsYUFBRCxDQUFyRCxDQUFOLENBQ0EsS0FBTSxDQUFDQyxNQUFNLENBQUUsQ0FBQ0MsZ0JBQUQsQ0FBbUJDLGdCQUFuQixDQUFULDBCQUFpREgsT0FBTyxDQUFDLGdCQUFELENBQXhELENBQU4sQyx1QkFDQUEsT0FBTyxDQUFDLGlDQUFELENBQVAsQyx1QkFDQUEsT0FBTyxDQUFDLGdDQUFELENBQVAsQ0FFQTs7Ozs7MEJBT0FJLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixDQUFDQyxlQUFELENBQWtCQyxPQUFsQixDQUEyQkMsVUFBM0IsR0FBMEMsK0NBQ3ZEQyxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JKLGVBQWhCLEVBRHVELHVCQUV2REcsTUFBTSxDQUFDQyxRQUFQLENBQWdCSCxPQUFoQixFQUZ1RCx1QkFHdkRJLEtBQUssQ0FBQ0QsUUFBTixDQUFlRixVQUFmLEVBSHVELHVCQUt2RCxNQUFPLENBQUMsU0FBVyx3QkFHZixLQUFNSSxDQUFBQSxhQUFhLHlCQUFHLEtBQU1mLENBQUFBLGFBQWEsQ0FBQ2dCLFFBQWQsQ0FBdUJQLGVBQXZCLENBQVQsQ0FBbkIsQ0FIZSx3QkFLZixHQUFHLENBQUNNLGFBQUosQ0FBbUIsd0RBQU0sSUFBSVYsQ0FBQUEsZ0JBQUosQ0FBc0IseUJBQXdCSSxlQUFnQixpQkFBOUQsQ0FBTixDQUFxRixDQUF4RyxnQ0FFQSxLQUFNLENBQUNRLE1BQUQsQ0FBU0MsTUFBVCxDQUFpQkMsTUFBakIsMkJBQTJCSixhQUEzQixDQUFOLENBRUEsS0FBTUssQ0FBQUEsS0FBSywwQkFBR0YsTUFBTSxDQUFDRyxJQUFQLENBQVlDLE1BQU0sRUFBSSxzREFBQUEsQ0FBQUEsTUFBTSxDQUFDQyxFQUFQLEdBQWNiLE9BQWQsQ0FBcUIsQ0FBM0MsQ0FBSCxDQUFYLENBVGUsd0JBV2YsR0FBRyxDQUFDVSxLQUFKLENBQVcsd0RBQU0sSUFBSWYsQ0FBQUEsZ0JBQUosQ0FBc0IsaUJBQWdCSyxPQUFRLGlCQUE5QyxDQUFOLENBQXFFLENBQWhGLGdDQVhlLHdCQWFmLEdBQUcsQ0FBQ1UsS0FBSyxDQUFDSSxNQUFWLENBQWtCLHdEQUFNLElBQUlsQixDQUFBQSxnQkFBSixDQUFxQixtQkFBckIsQ0FBTixDQUFnRCxDQUFsRSxnQ0FFQSxLQUFNbUIsQ0FBQUEsS0FBSywwQkFBR1IsTUFBTSxDQUFDSSxJQUFQLENBQVlLLE1BQU0sRUFBSSxpRkFBQUEsTUFBTSxDQUFDaEIsT0FBUCxHQUFtQkEsT0FBbkIsOEJBQThCZ0IsTUFBTSxDQUFDQyxLQUFQLEdBQWlCLEtBQS9DLEVBQW9ELENBQTFFLENBQUgsQ0FBWCxDQWZlLHdCQWlCZixHQUFHLENBQUNGLEtBQUosQ0FBVyx3REFBTSxJQUFJcEIsQ0FBQUEsZ0JBQUosQ0FBc0Isa0NBQXRCLENBQU4sQ0FBOEQsQ0FBekUsZ0NBRUEsS0FBTSxDQUFDdUIsVUFBRCwyQkFBZUgsS0FBZixDQUFOLENBbkJlLHdCQXFCZixLQUFNSSxDQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWW5CLFVBQVUsQ0FBQ29CLEdBQVgsQ0FBZSxLQUFNQyxDQUFBQSxJQUFOLEVBQWMsd0JBRTNDLEtBQU1DLENBQUFBLEtBQUssMEJBQUdkLE1BQU0sQ0FBQ0UsSUFBUCxDQUFZYSxLQUFLLEVBQUksc0RBQUFBLENBQUFBLEtBQUssQ0FBQ1gsRUFBTixHQUFhUyxJQUFiLENBQWlCLENBQXRDLENBQUgsQ0FBWCxDQUYyQyx3QkFJM0NQLEtBQUssQ0FBQ1UsS0FBTixDQUFjVixLQUFLLENBQUNVLEtBQU4sQ0FBY0YsS0FBSyxDQUFDRyxLQUFsQyxDQUoyQyx3QkFNM0MsR0FBSSxDQUFDSCxLQUFMLENBQVksd0RBQU0sSUFBSTVCLENBQUFBLGdCQUFKLENBQXNCLGdCQUFlMkIsSUFBSyxpQkFBMUMsQ0FBTixDQUFpRSxDQUE3RSxnQ0FOMkMsd0JBUTNDSixVQUFVLENBQUNTLElBQVgsQ0FBZ0IsR0FBSW5DLENBQUFBLFVBQUosQ0FBZSxDQUMzQjhCLElBRDJCLENBQWYsQ0FBaEIsRUFHSCxDQVhpQixDQUFaLENBQU4sQ0FyQmUsd0JBbUNmLEtBQU1qQixDQUFBQSxhQUFhLENBQUN1QixJQUFkLEVBQU4sQ0FFSCxDQXJDTSxHQUFQLENBc0NILENBM0NEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qge21vZGVsczoge0VzdGFibGlzaG1lbnQsIERpc2gsIERpc2hTdGF0dXN9fSA9IHJlcXVpcmUoJ3FybWVudS1kYXRhJylcbmNvbnN0IHtlcnJvcnM6IHtVbmV4aXN0ZW5jZUVycm9yLCBDcmVkZW50aWFsc0Vycm9yfX0gPSByZXF1aXJlKCdxcm1lbnUtY29tbW9ucycpXG5yZXF1aXJlKCdxcm1lbnUtY29tbW9ucy9wb2x5ZmlsbHMvc3RyaW5nJylcbnJlcXVpcmUoJ3FybWVudS1jb21tb25zL3BvbHlmaWxscy9hcnJheScpXG5cbi8qKlxuICogXG4gKiBAcGFyYW0ge3N0cmluZ30gZXN0YWJsaXNobWVudElkIGlkIGZyb20gdGhlIGVzdGFibGlzaG1lbnRcbiAqIEBwYXJhbSB7c3RyaW5nfSB0YWJsZUlkIGlkIGZyb20gdGhlIHRhYmxlXG4gKiBAcGFyYW0ge2FycmF5fSB1c2VyRGlzaGVzIGFycmF5IG9mIG11bHRpcGxlIGRpc2hlcyBpZCdzXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSAoZXN0YWJsaXNobWVudElkLCB0YWJsZUlkLCB1c2VyRGlzaGVzKSA9PiB7XG4gICAgU3RyaW5nLnZhbGlkYXRlKGVzdGFibGlzaG1lbnRJZClcbiAgICBTdHJpbmcudmFsaWRhdGUodGFibGVJZClcbiAgICBBcnJheS52YWxpZGF0ZSh1c2VyRGlzaGVzKVxuICAgIFxuICAgIHJldHVybiAoYXN5bmMoKSA9PiB7XG4gICAgICAgIFxuICAgICBcbiAgICAgICAgY29uc3QgZXN0YWJsaXNobWVudCA9IGF3YWl0IEVzdGFibGlzaG1lbnQuZmluZEJ5SWQoZXN0YWJsaXNobWVudElkKVxuXG4gICAgICAgIGlmKCFlc3RhYmxpc2htZW50KSB0aHJvdyBuZXcgVW5leGlzdGVuY2VFcnJvcihgRXN0YWJsaXNobWVudCB3aXRoIGlkICR7ZXN0YWJsaXNobWVudElkfSBkb2VzIG5vdCBleGlzdGApXG5cbiAgICAgICAgY29uc3Qge29yZGVycywgdGFibGVzLCBkaXNoZXN9ID0gZXN0YWJsaXNobWVudFxuXG4gICAgICAgIGNvbnN0IHRhYmxlID0gdGFibGVzLmZpbmQoX3RhYmxlID0+IF90YWJsZS5pZCA9PT0gdGFibGVJZClcblxuICAgICAgICBpZighdGFibGUpIHRocm93IG5ldyBVbmV4aXN0ZW5jZUVycm9yKGBUYWJsZSB3aXRoIGlkICR7dGFibGVJZH0gZG9lcyBub3QgZXhpc3RgKVxuXG4gICAgICAgIGlmKCF0YWJsZS5hY3RpdmUpIHRocm93IG5ldyBDcmVkZW50aWFsc0Vycm9yKFwiUGVybWlzc2lvbiBkZW5pZWRcIiApXG5cbiAgICAgICAgY29uc3Qgb3JkZXIgPSBvcmRlcnMuZmluZChfb3JkZXIgPT4gX29yZGVyLnRhYmxlSWQgPT09IHRhYmxlSWQgJiYgX29yZGVyLnBheWVkID09PSBmYWxzZSlcblxuICAgICAgICBpZighb3JkZXIpIHRocm93IG5ldyBVbmV4aXN0ZW5jZUVycm9yKGBObyBvcmRlciBvcGVuIHdpdGggdGhpcyBvcmRlcklkIGApXG5cbiAgICAgICAgY29uc3Qge2Rpc2hTdGF0dXN9ID0gb3JkZXJcblxuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbCh1c2VyRGlzaGVzLm1hcChhc3luYyBkaXNoID0+IHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBkaXNoZXMuZmluZChfZGlzaCA9PiBfZGlzaC5pZCA9PT0gZGlzaClcblxuICAgICAgICAgICAgb3JkZXIudG90YWwgPSBvcmRlci50b3RhbCArIG1hdGNoLnByaWNlXG5cbiAgICAgICAgICAgIGlmICghbWF0Y2gpIHRocm93IG5ldyBVbmV4aXN0ZW5jZUVycm9yKGBEaXNoIHdpdGggaWQgJHtkaXNofSBkb2VzIG5vdCBleGlzdGApXG5cbiAgICAgICAgICAgIGRpc2hTdGF0dXMucHVzaChuZXcgRGlzaFN0YXR1cyh7XG4gICAgICAgICAgICAgICAgZGlzaFxuICAgICAgICAgICAgfSkpXG4gICAgICAgIH0pKTtcbiAgICAgICAgXG5cbiAgICAgICAgYXdhaXQgZXN0YWJsaXNobWVudC5zYXZlKClcbiAgICAgICAgXG4gICAgfSkoKVxufSJdfQ==