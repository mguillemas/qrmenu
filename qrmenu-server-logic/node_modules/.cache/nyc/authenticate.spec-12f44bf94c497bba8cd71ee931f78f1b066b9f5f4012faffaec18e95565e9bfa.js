function cov_118r7dz418(){var path="/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/authenticate.spec.js";var hash="7b684179909c5be673da6cab0295ab523991e91a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/authenticate.spec.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:26}},"1":{start:{line:3,column:51},end:{line:3,column:58}},"2":{start:{line:5,column:34},end:{line:5,column:73}},"3":{start:{line:6,column:19},end:{line:6,column:23}},"4":{start:{line:7,column:19},end:{line:7,column:34}},"5":{start:{line:8,column:0},end:{line:8,column:40}},"6":{start:{line:9,column:48},end:{line:9,column:70}},"7":{start:{line:10,column:15},end:{line:10,column:34}},"8":{start:{line:11,column:46},end:{line:11,column:71}},"9":{start:{line:13,column:0},end:{line:74,column:2}},"10":{start:{line:14,column:4},end:{line:14,column:47}},"11":{start:{line:14,column:17},end:{line:14,column:46}},"12":{start:{line:18,column:4},end:{line:29,column:5}},"13":{start:{line:19,column:8},end:{line:28,column:36}},"14":{start:{line:21,column:12},end:{line:21,column:46}},"15":{start:{line:22,column:12},end:{line:22,column:32}},"16":{start:{line:23,column:12},end:{line:23,column:44}},"17":{start:{line:24,column:12},end:{line:24,column:44}},"18":{start:{line:26,column:12},end:{line:26,column:44}},"19":{start:{line:28,column:23},end:{line:28,column:35}},"20":{start:{line:31,column:4},end:{line:60,column:6}},"21":{start:{line:32,column:8},end:{line:32,column:16}},"22":{start:{line:33,column:8},end:{line:36,column:9}},"23":{start:{line:34,column:12},end:{line:35,column:76}},"24":{start:{line:35,column:40},end:{line:35,column:75}},"25":{start:{line:38,column:8},end:{line:48,column:9}},"26":{start:{line:40,column:12},end:{line:46,column:13}},"27":{start:{line:41,column:16},end:{line:43,column:61}},"28":{start:{line:42,column:39},end:{line:42,column:82}},"29":{start:{line:43,column:36},end:{line:43,column:60}},"30":{start:{line:45,column:16},end:{line:45,column:40}},"31":{start:{line:50,column:8},end:{line:59,column:10}},"32":{start:{line:51,column:12},end:{line:51,column:32}},"33":{start:{line:53,column:12},end:{line:58,column:18}},"34":{start:{line:54,column:30},end:{line:54,column:76}},"35":{start:{line:56,column:20},end:{line:56,column:60}},"36":{start:{line:57,column:20},end:{line:57,column:68}},"37":{start:{line:62,column:4},end:{line:69,column:5}},"38":{start:{line:63,column:8},end:{line:68,column:14}},"39":{start:{line:64,column:26},end:{line:64,column:72}},"40":{start:{line:66,column:16},end:{line:66,column:56}},"41":{start:{line:67,column:16},end:{line:67,column:90}},"42":{start:{line:71,column:4},end:{line:71,column:47}},"43":{start:{line:71,column:20},end:{line:71,column:46}},"44":{start:{line:73,column:4},end:{line:73,column:30}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:13,column:38},end:{line:13,column:39}},loc:{start:{line:13,column:44},end:{line:74,column:1}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:11},end:{line:14,column:12}},loc:{start:{line:14,column:17},end:{line:14,column:46}},line:14},"2":{name:"(anonymous_2)",decl:{start:{line:18,column:15},end:{line:18,column:16}},loc:{start:{line:19,column:8},end:{line:28,column:36}},line:19},"3":{name:"(anonymous_3)",decl:{start:{line:20,column:14},end:{line:20,column:15}},loc:{start:{line:20,column:20},end:{line:27,column:9}},line:20},"4":{name:"(anonymous_4)",decl:{start:{line:28,column:14},end:{line:28,column:15}},loc:{start:{line:28,column:23},end:{line:28,column:35}},line:28},"5":{name:"(anonymous_5)",decl:{start:{line:31,column:41},end:{line:31,column:42}},loc:{start:{line:31,column:47},end:{line:60,column:5}},line:31},"6":{name:"(anonymous_6)",decl:{start:{line:33,column:19},end:{line:33,column:20}},loc:{start:{line:34,column:12},end:{line:35,column:76}},line:34},"7":{name:"(anonymous_7)",decl:{start:{line:35,column:22},end:{line:35,column:23}},loc:{start:{line:35,column:40},end:{line:35,column:75}},line:35},"8":{name:"(anonymous_8)",decl:{start:{line:38,column:52},end:{line:38,column:53}},loc:{start:{line:38,column:58},end:{line:47,column:9}},line:38},"9":{name:"(anonymous_9)",decl:{start:{line:42,column:26},end:{line:42,column:27}},loc:{start:{line:42,column:39},end:{line:42,column:82}},line:42},"10":{name:"(anonymous_10)",decl:{start:{line:43,column:27},end:{line:43,column:28}},loc:{start:{line:43,column:36},end:{line:43,column:60}},line:43},"11":{name:"(anonymous_11)",decl:{start:{line:50,column:44},end:{line:50,column:45}},loc:{start:{line:50,column:50},end:{line:59,column:9}},line:50},"12":{name:"(anonymous_12)",decl:{start:{line:54,column:22},end:{line:54,column:23}},loc:{start:{line:54,column:28},end:{line:54,column:78}},line:54},"13":{name:"(anonymous_13)",decl:{start:{line:55,column:23},end:{line:55,column:24}},loc:{start:{line:55,column:32},end:{line:58,column:17}},line:55},"14":{name:"(anonymous_14)",decl:{start:{line:62,column:47},end:{line:62,column:48}},loc:{start:{line:63,column:8},end:{line:68,column:14}},line:63},"15":{name:"(anonymous_15)",decl:{start:{line:64,column:18},end:{line:64,column:19}},loc:{start:{line:64,column:24},end:{line:64,column:74}},line:64},"16":{name:"(anonymous_16)",decl:{start:{line:65,column:19},end:{line:65,column:20}},loc:{start:{line:65,column:28},end:{line:68,column:13}},line:65},"17":{name:"(anonymous_17)",decl:{start:{line:71,column:14},end:{line:71,column:15}},loc:{start:{line:71,column:20},end:{line:71,column:46}},line:71}},branchMap:{},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},b:{},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"7b684179909c5be673da6cab0295ab523991e91a"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_118r7dz418=function(){return actualCoverage;};}return actualCoverage;}cov_118r7dz418();cov_118r7dz418().s[0]++;require('dotenv').config();const{env:{TEST_MONGODB_URL:MONGODB_URL}}=(cov_118r7dz418().s[1]++,process);const authenticateEstablishment=(cov_118r7dz418().s[2]++,require('./authenticate-establishment'));const{random}=(cov_118r7dz418().s[3]++,Math);const{expect}=(cov_118r7dz418().s[4]++,require('chai'));cov_118r7dz418().s[5]++;require('qrmenu-commons/polyfills/json');const{mongoose,models:{Establishment}}=(cov_118r7dz418().s[6]++,require('qrmenu-data'));const bcrypt=(cov_118r7dz418().s[7]++,require('bcryptjs'));const{utils:{generateNIF:{generateNIF}}}=(cov_118r7dz418().s[8]++,require('qrmenu-commons'));cov_118r7dz418().s[9]++;describe('logic - authenticate user',()=>{cov_118r7dz418().f[0]++;cov_118r7dz418().s[10]++;before(()=>{cov_118r7dz418().f[1]++;cov_118r7dz418().s[11]++;return mongoose.connect(MONGODB_URL);});let establishment,nif,email,password,establishmentId,hash;cov_118r7dz418().s[12]++;beforeEach(()=>{cov_118r7dz418().f[2]++;cov_118r7dz418().s[13]++;return Establishment.deleteMany().then(()=>{cov_118r7dz418().f[3]++;cov_118r7dz418().s[14]++;establishment=`name-${random()}`;cov_118r7dz418().s[15]++;nif=generateNIF();cov_118r7dz418().s[16]++;email=`e-${random()}@mail.com`;cov_118r7dz418().s[17]++;password=`password${random()}`;cov_118r7dz418().s[18]++;return bcrypt.hash(password,10);}).then(_hash=>{cov_118r7dz418().f[4]++;cov_118r7dz418().s[19]++;return hash=_hash;});});cov_118r7dz418().s[20]++;describe('when user already exists',()=>{cov_118r7dz418().f[5]++;cov_118r7dz418().s[21]++;debugger;cov_118r7dz418().s[22]++;beforeEach(()=>{cov_118r7dz418().f[6]++;cov_118r7dz418().s[23]++;return Establishment.create({establishment,nif,email,password:hash}).then(_establishment=>{cov_118r7dz418().f[7]++;cov_118r7dz418().s[24]++;return establishmentId=_establishment.id;});});cov_118r7dz418().s[25]++;it('should succeed on correct credentials',()=>{cov_118r7dz418().f[8]++;cov_118r7dz418().s[26]++;try{cov_118r7dz418().s[27]++;authenticateEstablishment(email,password).then(_workerId=>{cov_118r7dz418().f[9]++;cov_118r7dz418().s[28]++;return expect(_workerId).to.equal(establishmentId);}).catch(error=>{cov_118r7dz418().f[10]++;cov_118r7dz418().s[29]++;return expect(error).to.be.null;});}catch(error){cov_118r7dz418().s[30]++;expect(error).to.be.null;}});cov_118r7dz418().s[31]++;it('should fail on wrong password',()=>{cov_118r7dz418().f[11]++;cov_118r7dz418().s[32]++;password+='wrong-';cov_118r7dz418().s[33]++;return authenticateEstablishment(email,password).then(()=>{cov_118r7dz418().f[12]++;cov_118r7dz418().s[34]++;throw new Error('should not reach this point');}).catch(error=>{cov_118r7dz418().f[13]++;cov_118r7dz418().s[35]++;expect(error).to.be.an.instanceof(Error);cov_118r7dz418().s[36]++;expect(error.message).to.equal(`wrong password`);});});});cov_118r7dz418().s[37]++;it('should fail when user does not exist',()=>{cov_118r7dz418().f[14]++;cov_118r7dz418().s[38]++;return authenticateEstablishment(email,password).then(()=>{cov_118r7dz418().f[15]++;cov_118r7dz418().s[39]++;throw new Error('should not reach this point');}).catch(error=>{cov_118r7dz418().f[16]++;cov_118r7dz418().s[40]++;expect(error).to.be.an.instanceof(Error);cov_118r7dz418().s[41]++;expect(error.message).to.equal(`user with e-mail ${email} does not exist`);});});cov_118r7dz418().s[42]++;afterEach(()=>{cov_118r7dz418().f[17]++;cov_118r7dz418().s[43]++;return Establishment.deleteMany();});cov_118r7dz418().s[44]++;after(mongoose.disconnect);});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0ZS5zcGVjLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJjb25maWciLCJlbnYiLCJURVNUX01PTkdPREJfVVJMIiwiTU9OR09EQl9VUkwiLCJwcm9jZXNzIiwiYXV0aGVudGljYXRlRXN0YWJsaXNobWVudCIsInJhbmRvbSIsIk1hdGgiLCJleHBlY3QiLCJtb25nb29zZSIsIm1vZGVscyIsIkVzdGFibGlzaG1lbnQiLCJiY3J5cHQiLCJ1dGlscyIsImdlbmVyYXRlTklGIiwiZGVzY3JpYmUiLCJiZWZvcmUiLCJjb25uZWN0IiwiZXN0YWJsaXNobWVudCIsIm5pZiIsImVtYWlsIiwicGFzc3dvcmQiLCJlc3RhYmxpc2htZW50SWQiLCJoYXNoIiwiYmVmb3JlRWFjaCIsImRlbGV0ZU1hbnkiLCJ0aGVuIiwiX2hhc2giLCJjcmVhdGUiLCJfZXN0YWJsaXNobWVudCIsImlkIiwiaXQiLCJfd29ya2VySWQiLCJ0byIsImVxdWFsIiwiY2F0Y2giLCJlcnJvciIsImJlIiwibnVsbCIsIkVycm9yIiwiYW4iLCJpbnN0YW5jZW9mIiwibWVzc2FnZSIsImFmdGVyRWFjaCIsImFmdGVyIiwiZGlzY29ubmVjdCJdLCJtYXBwaW5ncyI6IjhzTUFlWTttSEFmWkEsT0FBTyxDQUFDLFFBQUQsQ0FBUCxDQUFrQkMsTUFBbEIsR0FFQSxLQUFNLENBQUVDLEdBQUcsQ0FBRSxDQUFFQyxnQkFBZ0IsQ0FBRUMsV0FBcEIsQ0FBUCwyQkFBNkNDLE9BQTdDLENBQU4sQ0FFQSxLQUFNQyxDQUFBQSx5QkFBeUIsMEJBQUdOLE9BQU8sQ0FBQyw4QkFBRCxDQUFWLENBQS9CLENBQ0EsS0FBTSxDQUFFTyxNQUFGLDJCQUFhQyxJQUFiLENBQU4sQ0FDQSxLQUFNLENBQUVDLE1BQUYsMkJBQWFULE9BQU8sQ0FBQyxNQUFELENBQXBCLENBQU4sQyx3QkFDQUEsT0FBTyxDQUFDLCtCQUFELENBQVAsQ0FDQSxLQUFNLENBQUVVLFFBQUYsQ0FBWUMsTUFBTSxDQUFFLENBQUVDLGFB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QUFvQkcsRUFBcEIsQ0FBdUJDLFVBQXZCLENBQWtDRixLQUFsQyxFQURZLHlCQUVaL0IsTUFBTSxDQUFDNEIsS0FBSyxDQUFDTSxPQUFQLENBQU4sQ0FBc0JULEVBQXRCLENBQXlCQyxLQUF6QixDQUFnQyxnQkFBaEMsRUFDSCxDQUxFLENBQVAsQ0FNSCxDQVRDLENBQUYsQ0FVSCxDQTdCTyxDQUFSLENBbEJ3Qyx5QkFpRHhDSCxFQUFFLENBQUMsc0NBQUQsQ0FBeUMsSUFDdkMseURBQUExQixDQUFBQSx5QkFBeUIsQ0FBQ2UsS0FBRCxDQUFRQyxRQUFSLENBQXpCLENBQ0tLLElBREwsQ0FDVSxJQUFNLG1EQUFFLEtBQU0sSUFBSWEsQ0FBQUEsS0FBSixDQUFVLDZCQUFWLENBQU4sQ0FBZ0QsQ0FEbEUsRUFFS0osS0FGTCxDQUVXQyxLQUFLLEVBQUksbURBQ1o1QixNQUFNLENBQUM0QixLQUFELENBQU4sQ0FBY0gsRUFBZCxDQUFpQkksRUFBakIsQ0FBb0JHLEVBQXBCLENBQXVCQyxVQUF2QixDQUFrQ0YsS0FBbEMsRUFEWSx5QkFFWi9CLE1BQU0sQ0FBQzRCLEtBQUssQ0FBQ00sT0FBUCxDQUFOLENBQXNCVCxFQUF0QixDQUF5QkMsS0FBekIsQ0FBZ0Msb0JBQW1CZCxLQUFNLGlCQUF6RCxFQUNILENBTEwsRUFLTSxDQU5SLENBQUYsQ0FqRHdDLHlCQTBEeEN1QixTQUFTLENBQUMsSUFBTSx5REFBQWhDLENBQUFBLGFBQWEsQ0FBQ2MsVUFBZCxHQUEwQixDQUFqQyxDQUFULENBMUR3Qyx5QkE0RHhDbUIsS0FBSyxDQUFDbkMsUUFBUSxDQUFDb0MsVUFBVixDQUFMLENBQ0gsQ0E3RE8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZygpXG5cbmNvbnN0IHsgZW52OiB7IFRFU1RfTU9OR09EQl9VUkw6IE1PTkdPREJfVVJMIH0gfSA9IHByb2Nlc3NcblxuY29uc3QgYXV0aGVudGljYXRlRXN0YWJsaXNobWVudCA9IHJlcXVpcmUoJy4vYXV0aGVudGljYXRlLWVzdGFibGlzaG1lbnQnKVxuY29uc3QgeyByYW5kb20gfSA9IE1hdGhcbmNvbnN0IHsgZXhwZWN0IH0gPSByZXF1aXJlKCdjaGFpJylcbnJlcXVpcmUoJ3FybWVudS1jb21tb25zL3BvbHlmaWxscy9qc29uJylcbmNvbnN0IHsgbW9uZ29vc2UsIG1vZGVsczogeyBFc3RhYmxpc2htZW50IH0gfSA9IHJlcXVpcmUoJ3FybWVudS1kYXRhJylcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcbmNvbnN0IHt1dGlsczoge2dlbmVyYXRlTklGOiB7Z2VuZXJhdGVOSUZ9fX0gPSByZXF1aXJlKCdxcm1lbnUtY29tbW9ucycpXG5cbmRlc2NyaWJlKCdsb2dpYyAtIGF1dGhlbnRpY2F0ZSB1c2VyJywgKCkgPT4ge1xuICAgIGJlZm9yZSgoKSA9PiBtb25nb29zZS5jb25uZWN0KE1PTkdPREJfVVJMKSlcblxuICAgIGxldCBlc3RhYmxpc2htZW50LCBuaWYsIGVtYWlsLCBwYXNzd29yZCwgZXN0YWJsaXNobWVudElkLCBoYXNoXG5cbiAgICBiZWZvcmVFYWNoKCgpID0+XG4gICAgICAgIEVzdGFibGlzaG1lbnQuZGVsZXRlTWFueSgpXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGVzdGFibGlzaG1lbnQgPSBgbmFtZS0ke3JhbmRvbSgpfWBcbiAgICAgICAgICAgIG5pZiA9ICBnZW5lcmF0ZU5JRigpXG4gICAgICAgICAgICBlbWFpbCA9IGBlLSR7cmFuZG9tKCl9QG1haWwuY29tYFxuICAgICAgICAgICAgcGFzc3dvcmQgPSBgcGFzc3dvcmQke3JhbmRvbSgpfWBcblxuICAgICAgICAgICAgcmV0dXJuIGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMClcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4oX2hhc2ggPT4gaGFzaCA9IF9oYXNoKVxuICAgIClcblxuICAgIGRlc2NyaWJlKCd3aGVuIHVzZXIgYWxyZWFkeSBleGlzdHMnLCAoKSA9PiB7XG4gICAgICAgIGRlYnVnZ2VyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT5cbiAgICAgICAgICAgIEVzdGFibGlzaG1lbnQuY3JlYXRlKHsgZXN0YWJsaXNobWVudCwgbmlmLCBlbWFpbCwgcGFzc3dvcmQ6IGhhc2ggfSlcbiAgICAgICAgICAgICAgICAudGhlbihfZXN0YWJsaXNobWVudCA9PiBlc3RhYmxpc2htZW50SWQgPSBfZXN0YWJsaXNobWVudC5pZClcbiAgICAgICAgKVxuXG4gICAgICAgIGl0KCdzaG91bGQgc3VjY2VlZCBvbiBjb3JyZWN0IGNyZWRlbnRpYWxzJywgKCkgPT4ge1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF1dGhlbnRpY2F0ZUVzdGFibGlzaG1lbnQoZW1haWwsIHBhc3N3b3JkKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihfd29ya2VySWQgPT4gZXhwZWN0KF93b3JrZXJJZCkudG8uZXF1YWwoZXN0YWJsaXNobWVudElkKSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IGV4cGVjdChlcnJvcikudG8uYmUubnVsbClcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGVycm9yKS50by5iZS5udWxsXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgKVxuXG4gICAgICAgIGl0KCdzaG91bGQgZmFpbCBvbiB3cm9uZyBwYXNzd29yZCcsICgpID0+IHtcbiAgICAgICAgICAgIHBhc3N3b3JkICs9ICd3cm9uZy0nXG5cbiAgICAgICAgICAgIHJldHVybiBhdXRoZW50aWNhdGVFc3RhYmxpc2htZW50KGVtYWlsLCBwYXNzd29yZClcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7IHRocm93IG5ldyBFcnJvcignc2hvdWxkIG5vdCByZWFjaCB0aGlzIHBvaW50JykgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvLmJlLmFuLmluc3RhbmNlb2YoRXJyb3IpXG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50by5lcXVhbChgd3JvbmcgcGFzc3dvcmRgKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgZmFpbCB3aGVuIHVzZXIgZG9lcyBub3QgZXhpc3QnLCAoKSA9PlxuICAgICAgICBhdXRoZW50aWNhdGVFc3RhYmxpc2htZW50KGVtYWlsLCBwYXNzd29yZClcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHsgdGhyb3cgbmV3IEVycm9yKCdzaG91bGQgbm90IHJlYWNoIHRoaXMgcG9pbnQnKSB9KVxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvLmJlLmFuLmluc3RhbmNlb2YoRXJyb3IpXG4gICAgICAgICAgICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvLmVxdWFsKGB1c2VyIHdpdGggZS1tYWlsICR7ZW1haWx9IGRvZXMgbm90IGV4aXN0YClcbiAgICAgICAgICAgIH0pXG4gICAgKVxuXG4gICAgYWZ0ZXJFYWNoKCgpID0+IEVzdGFibGlzaG1lbnQuZGVsZXRlTWFueSgpKVxuXG4gICAgYWZ0ZXIobW9uZ29vc2UuZGlzY29ubmVjdClcbn0pIl19