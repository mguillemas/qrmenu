function cov_2jr11gvjmf(){var path="/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/assign-num-of-tables.js";var hash="f6bc4eb5905cbd33f05ca0d4d3b6f2e5e5369ed4";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-server-logic/assign-num-of-tables.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:42}},"1":{start:{line:2,column:0},end:{line:2,column:42}},"2":{start:{line:3,column:59},end:{line:3,column:84}},"3":{start:{line:4,column:36},end:{line:4,column:58}},"4":{start:{line:13,column:0},end:{line:40,column:1}},"5":{start:{line:14,column:4},end:{line:14,column:44}},"6":{start:{line:15,column:4},end:{line:15,column:37}},"7":{start:{line:16,column:4},end:{line:16,column:39}},"8":{start:{line:18,column:4},end:{line:39,column:8}},"9":{start:{line:19,column:30},end:{line:19,column:75}},"10":{start:{line:21,column:8},end:{line:21,column:112}},"11":{start:{line:21,column:27},end:{line:21,column:112}},"12":{start:{line:23,column:32},end:{line:23,column:45}},"13":{start:{line:25,column:23},end:{line:25,column:81}},"14":{start:{line:25,column:45},end:{line:25,column:80}},"15":{start:{line:27,column:8},end:{line:27,column:111}},"16":{start:{line:27,column:36},end:{line:27,column:111}},"17":{start:{line:29,column:8},end:{line:29,column:37}},"18":{start:{line:29,column:26},end:{line:29,column:37}},"19":{start:{line:31,column:8},end:{line:33,column:9}},"20":{start:{line:31,column:24},end:{line:31,column:25}},"21":{start:{line:32,column:12},end:{line:32,column:32}},"22":{start:{line:36,column:8},end:{line:36,column:80}},"23":{start:{line:38,column:8},end:{line:38,column:14}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:13,column:17},end:{line:13,column:18}},loc:{start:{line:13,column:59},end:{line:40,column:1}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:18,column:12},end:{line:18,column:13}},loc:{start:{line:18,column:23},end:{line:39,column:5}},line:18},"2":{name:"(anonymous_2)",decl:{start:{line:25,column:34},end:{line:25,column:35}},loc:{start:{line:25,column:45},end:{line:25,column:80}},line:25}},branchMap:{"0":{loc:{start:{line:21,column:8},end:{line:21,column:112}},type:"if",locations:[{start:{line:21,column:8},end:{line:21,column:112}},{start:{line:21,column:8},end:{line:21,column:112}}],line:21},"1":{loc:{start:{line:27,column:8},end:{line:27,column:111}},type:"if",locations:[{start:{line:27,column:8},end:{line:27,column:111}},{start:{line:27,column:8},end:{line:27,column:111}}],line:27},"2":{loc:{start:{line:29,column:8},end:{line:29,column:37}},type:"if",locations:[{start:{line:29,column:8},end:{line:29,column:37}},{start:{line:29,column:8},end:{line:29,column:37}}],line:29}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"f6bc4eb5905cbd33f05ca0d4d3b6f2e5e5369ed4"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2jr11gvjmf=function(){return actualCoverage;};}return actualCoverage;}cov_2jr11gvjmf();cov_2jr11gvjmf().s[0]++;require('qrmenu-commons/polyfills/string');cov_2jr11gvjmf().s[1]++;require('qrmenu-commons/polyfills/number');const{errors:{UnexistenceError,CredentialsError}}=(cov_2jr11gvjmf().s[2]++,require('qrmenu-commons'));const{models:{Establishment}}=(cov_2jr11gvjmf().s[3]++,require('qrmenu-data'));/**
 * 
 * @param {string} establishmentId id of establishment 
 * @param {string} workerId id of the worker
 * @param {number} numTables number of tables to set
 */cov_2jr11gvjmf().s[4]++;module.exports=(establishmentId,workerId,numTables)=>{cov_2jr11gvjmf().f[0]++;cov_2jr11gvjmf().s[5]++;String.validate.notVoid(establishmentId);cov_2jr11gvjmf().s[6]++;String.validate.notVoid(workerId);cov_2jr11gvjmf().s[7]++;Number.validate.positive(numTables);cov_2jr11gvjmf().s[8]++;return(async()=>{cov_2jr11gvjmf().f[1]++;const establishment=(cov_2jr11gvjmf().s[9]++,await Establishment.findById(establishmentId));cov_2jr11gvjmf().s[10]++;if(!establishment){cov_2jr11gvjmf().b[0][0]++;cov_2jr11gvjmf().s[11]++;throw new UnexistenceError(`Establishment with id ${establishmentId} does not exist`);}else{cov_2jr11gvjmf().b[0][1]++;}const{staff,tables}=(cov_2jr11gvjmf().s[12]++,establishment);const worker=(cov_2jr11gvjmf().s[13]++,staff.find(_worker=>{cov_2jr11gvjmf().f[2]++;cov_2jr11gvjmf().s[14]++;return _worker._id.toString()===workerId;}));cov_2jr11gvjmf().s[15]++;if(worker.role!=="owner"){cov_2jr11gvjmf().b[1][0]++;cov_2jr11gvjmf().s[16]++;throw new CredentialsError(`You can not add tables with your working role`);}else{cov_2jr11gvjmf().b[1][1]++;}cov_2jr11gvjmf().s[17]++;if(tables.length){cov_2jr11gvjmf().b[2][0]++;cov_2jr11gvjmf().s[18]++;tables=[];}else{cov_2jr11gvjmf().b[2][1]++;}cov_2jr11gvjmf().s[19]++;for(let table=(cov_2jr11gvjmf().s[20]++,1);table<=numTables;table++){cov_2jr11gvjmf().s[21]++;tables.push({table});}cov_2jr11gvjmf().s[22]++;await Establishment.findByIdAndUpdate(establishmentId,{$set:{tables}});cov_2jr11gvjmf().s[23]++;return;})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2lnbi1udW0tb2YtdGFibGVzLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJlcnJvcnMiLCJVbmV4aXN0ZW5jZUVycm9yIiwiQ3JlZGVudGlhbHNFcnJvciIsIm1vZGVscyIsIkVzdGFibGlzaG1lbnQiLCJtb2R1bGUiLCJleHBvcnRzIiwiZXN0YWJsaXNobWVudElkIiwid29ya2VySWQiLCJudW1UYWJsZXMiLCJTdHJpbmciLCJ2YWxpZGF0ZSIsIm5vdFZvaWQiLCJOdW1iZXIiLCJwb3NpdGl2ZSIsImVzdGFibGlzaG1lbnQiLCJmaW5kQnlJZCIsInN0YWZmIiwidGFibGVzIiwid29ya2VyIiwiZmluZCIsIl93b3JrZXIiLCJfaWQiLCJ0b1N0cmluZyIsInJvbGUiLCJsZW5ndGgiLCJ0YWJsZSIsInB1c2giLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRzZXQiXSwibWFwcGluZ3MiOiIrdUdBZVk7bUhBZlpBLE9BQU8sQ0FBQyxpQ0FBRCxDQUFQLEMsd0JBQ0FBLE9BQU8sQ0FBQyxpQ0FBRCxDQUFQLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsZ0JBQUYsQ0FBb0JDLGdCQUFwQixDQUFWLDJCQUFxREgsT0FBTyxDQUFDLGdCQUFELENBQTVELENBQU4sQ0FDQSxLQUFNLENBQUVJLE1BQU0sQ0FBRSxDQUFDQyxhQUFELENBQVYsMkJBQThCTCxPQUFPLENBQUMsYUFBRCxDQUFyQyxDQUFOLENBRUE7Ozs7OzJCQU9BTSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBQ0MsZUFBRCxDQUFrQkMsUUFBbEIsQ0FBNEJDLFNBQTVCLEdBQTBDLGlEQUN2REMsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3QkwsZUFBeEIsRUFEdUQsd0JBRXZERyxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLE9BQWhCLENBQXdCSixRQUF4QixFQUZ1RCx3QkFHdkRLLE1BQU0sQ0FBQ0YsUUFBUCxDQUFnQkcsUUFBaEIsQ0FBeUJMLFNBQXpCLEVBSHVELHdCQUt2RCxNQUFPLENBQUMsU0FBVyx5QkFDZixLQUFNTSxDQUFBQSxhQUFhLDBCQUFHLEtBQU1YLENBQUFBLGFBQWEsQ0FBQ1ksUUFBZCxDQUF1QlQsZUFBdkIsQ0FBVCxDQUFuQixDQURlLHlCQUdmLEdBQUcsQ0FBQ1EsYUFBSixDQUFtQiwwREFBTSxJQUFJZCxDQUFBQSxnQkFBSixDQUFzQix5QkFBd0JNLGVBQWdCLGlCQUE5RCxDQUFOLENBQXFGLENBQXhHLGlDQUVBLEtBQU0sQ0FBQ1UsS0FBRCxDQUFRQyxNQUFSLDRCQUFrQkgsYUFBbEIsQ0FBTixDQUVBLEtBQU1JLENBQUFBLE1BQU0sMkJBQUdGLEtBQUssQ0FBQ0csSUFBTixDQUFXQyxPQUFPLEVBQUksd0RBQUFBLENBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxRQUFaLEtBQTJCZixRQUEzQixDQUFtQyxDQUF6RCxDQUFILENBQVosQ0FQZSx5QkFTZixHQUFHVyxNQUFNLENBQUNLLElBQVAsR0FBZ0IsT0FBbkIsQ0FBNEIsMERBQU0sSUFBSXRCLENBQUFBLGdCQUFKLENBQXNCLCtDQUF0QixDQUFOLENBQTJFLENBQXZHLGlDQVRlLHlCQVdmLEdBQUdnQixNQUFNLENBQUNPLE1BQVYsQ0FBa0IscURBQUFQLE1BQU0sQ0FBRyxFQUFULENBQVcsQ0FBN0IsaUNBWGUseUJBYWYsSUFBSSxHQUFJUSxDQUFBQSxLQUFLLDJCQUFHLENBQUgsQ0FBYixDQUFtQkEsS0FBSyxFQUFJakIsU0FBNUIsQ0FBdUNpQixLQUFLLEVBQTVDLENBQStDLDBCQUMzQ1IsTUFBTSxDQUFDUyxJQUFQLENBQVksQ0FBQ0QsS0FBRCxDQUFaLEVBQ0gsQ0FmYyx5QkFrQmYsS0FBTXRCLENBQUFBLGFBQWEsQ0FBQ3dCLGlCQUFkLENBQWdDckIsZUFBaEMsQ0FBaUQsQ0FBQ3NCLElBQUksQ0FBRSxDQUFDWCxNQUFELENBQVAsQ0FBakQsQ0FBTixDQWxCZSx5QkFvQmYsT0FDSCxDQXJCTSxHQUFQLENBc0JILENBM0JEIiwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgncXJtZW51LWNvbW1vbnMvcG9seWZpbGxzL3N0cmluZycpXG5yZXF1aXJlKCdxcm1lbnUtY29tbW9ucy9wb2x5ZmlsbHMvbnVtYmVyJylcbmNvbnN0IHsgZXJyb3JzOiB7IFVuZXhpc3RlbmNlRXJyb3IsIENyZWRlbnRpYWxzRXJyb3IgfSB9ID0gcmVxdWlyZSgncXJtZW51LWNvbW1vbnMnKVxuY29uc3QgeyBtb2RlbHM6IHtFc3RhYmxpc2htZW50fSB9ID0gcmVxdWlyZSgncXJtZW51LWRhdGEnKVxuXG4vKipcbiAqIFxuICogQHBhcmFtIHtzdHJpbmd9IGVzdGFibGlzaG1lbnRJZCBpZCBvZiBlc3RhYmxpc2htZW50IFxuICogQHBhcmFtIHtzdHJpbmd9IHdvcmtlcklkIGlkIG9mIHRoZSB3b3JrZXJcbiAqIEBwYXJhbSB7bnVtYmVyfSBudW1UYWJsZXMgbnVtYmVyIG9mIHRhYmxlcyB0byBzZXRcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IChlc3RhYmxpc2htZW50SWQsIHdvcmtlcklkLCBudW1UYWJsZXMpID0+IHtcbiAgICBTdHJpbmcudmFsaWRhdGUubm90Vm9pZChlc3RhYmxpc2htZW50SWQpXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQod29ya2VySWQpXG4gICAgTnVtYmVyLnZhbGlkYXRlLnBvc2l0aXZlKG51bVRhYmxlcylcbiAgICBcbiAgICByZXR1cm4gKGFzeW5jKCkgPT4ge1xuICAgICAgICBjb25zdCBlc3RhYmxpc2htZW50ID0gYXdhaXQgRXN0YWJsaXNobWVudC5maW5kQnlJZChlc3RhYmxpc2htZW50SWQpXG4gICAgICAgIFxuICAgICAgICBpZighZXN0YWJsaXNobWVudCkgdGhyb3cgbmV3IFVuZXhpc3RlbmNlRXJyb3IoYEVzdGFibGlzaG1lbnQgd2l0aCBpZCAke2VzdGFibGlzaG1lbnRJZH0gZG9lcyBub3QgZXhpc3RgKVxuICAgICAgICBcbiAgICAgICAgY29uc3Qge3N0YWZmLCB0YWJsZXN9ID0gZXN0YWJsaXNobWVudFxuXG4gICAgICAgIGNvbnN0IHdvcmtlciA9IHN0YWZmLmZpbmQoX3dvcmtlciA9PiBfd29ya2VyLl9pZC50b1N0cmluZygpID09PSB3b3JrZXJJZClcblxuICAgICAgICBpZih3b3JrZXIucm9sZSAhPT0gXCJvd25lclwiKSB0aHJvdyBuZXcgQ3JlZGVudGlhbHNFcnJvcihgWW91IGNhbiBub3QgYWRkIHRhYmxlcyB3aXRoIHlvdXIgd29ya2luZyByb2xlYClcblxuICAgICAgICBpZih0YWJsZXMubGVuZ3RoKSB0YWJsZXMgPSBbXVxuXG4gICAgICAgIGZvcihsZXQgdGFibGUgPSAxOyB0YWJsZSA8PSBudW1UYWJsZXM7IHRhYmxlKyspe1xuICAgICAgICAgICAgdGFibGVzLnB1c2goe3RhYmxlfSlcbiAgICAgICAgfVxuXG5cbiAgICAgICAgYXdhaXQgRXN0YWJsaXNobWVudC5maW5kQnlJZEFuZFVwZGF0ZShlc3RhYmxpc2htZW50SWQsIHskc2V0OiB7dGFibGVzfX0pXG5cbiAgICAgICAgcmV0dXJuXG4gICAgfSkoKVxufSJdfQ==