function cov_1ycxv8bdsz(){var path="/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-client-logic/register-establishment.spec.js";var hash="292dfffd543efd5e2f94ef258651113a147d937a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-client-logic/register-establishment.spec.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:26}},"1":{start:{line:3,column:75},end:{line:3,column:82}},"2":{start:{line:5,column:30},end:{line:5,column:65}},"3":{start:{line:6,column:19},end:{line:6,column:23}},"4":{start:{line:7,column:19},end:{line:7,column:34}},"5":{start:{line:8,column:0},end:{line:8,column:40}},"6":{start:{line:9,column:46},end:{line:9,column:71}},"7":{start:{line:10,column:18},end:{line:10,column:40}},"8":{start:{line:11,column:15},end:{line:11,column:34}},"9":{start:{line:12,column:16},end:{line:12,column:36}},"10":{start:{line:13,column:0},end:{line:13,column:39}},"11":{start:{line:15,column:0},end:{line:15,column:25}},"12":{start:{line:17,column:0},end:{line:56,column:2}},"13":{start:{line:19,column:4},end:{line:21,column:5}},"14":{start:{line:19,column:17},end:{line:20,column:90}},"15":{start:{line:20,column:28},end:{line:20,column:89}},"16":{start:{line:25,column:4},end:{line:33,column:5}},"17":{start:{line:26,column:8},end:{line:32,column:14}},"18":{start:{line:28,column:16},end:{line:28,column:59}},"19":{start:{line:29,column:16},end:{line:29,column:40}},"20":{start:{line:30,column:16},end:{line:30,column:48}},"21":{start:{line:31,column:16},end:{line:31,column:49}},"22":{start:{line:35,column:4},end:{line:52,column:5}},"23":{start:{line:37,column:8},end:{line:51,column:52}},"24":{start:{line:38,column:24},end:{line:38,column:55}},"25":{start:{line:41,column:16},end:{line:41,column:57}},"26":{start:{line:43,column:41},end:{line:43,column:55}},"27":{start:{line:45,column:16},end:{line:45,column:76}},"28":{start:{line:46,column:16},end:{line:46,column:56}},"29":{start:{line:47,column:16},end:{line:47,column:69}},"30":{start:{line:49,column:16},end:{line:49,column:81}},"31":{start:{line:51,column:27},end:{line:51,column:51}},"32":{start:{line:55,column:4},end:{line:55,column:69}},"33":{start:{line:55,column:16},end:{line:55,column:68}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:43},end:{line:17,column:44}},loc:{start:{line:17,column:49},end:{line:56,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:19,column:11},end:{line:19,column:12}},loc:{start:{line:19,column:17},end:{line:20,column:90}},line:19},"2":{name:"(anonymous_2)",decl:{start:{line:20,column:14},end:{line:20,column:15}},loc:{start:{line:20,column:28},end:{line:20,column:89}},line:20},"3":{name:"(anonymous_3)",decl:{start:{line:25,column:15},end:{line:25,column:16}},loc:{start:{line:26,column:8},end:{line:32,column:14}},line:26},"4":{name:"(anonymous_4)",decl:{start:{line:27,column:18},end:{line:27,column:19}},loc:{start:{line:27,column:24},end:{line:32,column:13}},line:27},"5":{name:"(anonymous_5)",decl:{start:{line:35,column:39},end:{line:35,column:40}},loc:{start:{line:37,column:8},end:{line:51,column:52}},line:37},"6":{name:"(anonymous_6)",decl:{start:{line:38,column:18},end:{line:38,column:19}},loc:{start:{line:38,column:24},end:{line:38,column:55}},line:38},"7":{name:"(anonymous_7)",decl:{start:{line:39,column:18},end:{line:39,column:19}},loc:{start:{line:39,column:36},end:{line:50,column:13}},line:39},"8":{name:"(anonymous_8)",decl:{start:{line:51,column:18},end:{line:51,column:19}},loc:{start:{line:51,column:27},end:{line:51,column:51}},line:51},"9":{name:"(anonymous_9)",decl:{start:{line:55,column:10},end:{line:55,column:11}},loc:{start:{line:55,column:16},end:{line:55,column:68}},line:55}},branchMap:{},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"292dfffd543efd5e2f94ef258651113a147d937a"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1ycxv8bdsz=function(){return actualCoverage;};}return actualCoverage;}cov_1ycxv8bdsz();cov_1ycxv8bdsz().s[0]++;require('dotenv').config();const{env:{TEST_MONGODB_URL:MONGODB_URL,TEST_API_URL:API_URL}}=(cov_1ycxv8bdsz().s[1]++,process);const registerEstablishment=(cov_1ycxv8bdsz().s[2]++,require('./register-establishment'));const{random}=(cov_1ycxv8bdsz().s[3]++,Math);const{expect}=(cov_1ycxv8bdsz().s[4]++,require('chai'));cov_1ycxv8bdsz().s[5]++;require('qrmenu-commons/polyfills/json');const{utils:{generateNIF:{generateNIF}}}=(cov_1ycxv8bdsz().s[6]++,require('qrmenu-commons'));const{mongo}=(cov_1ycxv8bdsz().s[7]++,require('qrmenu-data'));const bcrypt=(cov_1ycxv8bdsz().s[8]++,require('bcryptjs'));const context=(cov_1ycxv8bdsz().s[9]++,require('./context'));cov_1ycxv8bdsz().s[10]++;require('qrmenu-commons/ponyfills/xhr');cov_1ycxv8bdsz().s[11]++;context.API_URL=API_URL;cov_1ycxv8bdsz().s[12]++;describe('logic - register establishment',()=>{cov_1ycxv8bdsz().f[0]++;let establishments;cov_1ycxv8bdsz().s[13]++;before(()=>{cov_1ycxv8bdsz().f[1]++;cov_1ycxv8bdsz().s[14]++;return mongo.connect(MONGODB_URL).then(connection=>{cov_1ycxv8bdsz().f[2]++;cov_1ycxv8bdsz().s[15]++;return establishments=connection.db().collection('establishments');});});let establishment,nif,email,password;cov_1ycxv8bdsz().s[16]++;beforeEach(()=>{cov_1ycxv8bdsz().f[3]++;cov_1ycxv8bdsz().s[17]++;return establishments.deleteMany().then(()=>{cov_1ycxv8bdsz().f[4]++;cov_1ycxv8bdsz().s[18]++;establishment=`establishment-${random()}`;cov_1ycxv8bdsz().s[19]++;nif=`${generateNIF()}`;cov_1ycxv8bdsz().s[20]++;email=`e-${random()}@mail.com`;cov_1ycxv8bdsz().s[21]++;password=`password-${random()}`;});});cov_1ycxv8bdsz().s[22]++;it('should succeed on valid data',()=>{cov_1ycxv8bdsz().f[5]++;cov_1ycxv8bdsz().s[23]++;return registerEstablishment(establishment,nif,email,password).then(()=>{cov_1ycxv8bdsz().f[6]++;cov_1ycxv8bdsz().s[24]++;return establishments.find().toArray();}).then(establishments=>{cov_1ycxv8bdsz().f[7]++;cov_1ycxv8bdsz().s[25]++;expect(establishments.length).to.equal(1);const[_establishment]=(cov_1ycxv8bdsz().s[26]++,establishments);cov_1ycxv8bdsz().s[27]++;expect(_establishment.establishment).to.equal(establishment);cov_1ycxv8bdsz().s[28]++;expect(_establishment.nif).to.equal(nif);cov_1ycxv8bdsz().s[29]++;expect(_establishment.staff[0].email).to.equal(email);cov_1ycxv8bdsz().s[30]++;return bcrypt.compare(password,_establishment.staff[0].password);}).then(match=>{cov_1ycxv8bdsz().f[8]++;cov_1ycxv8bdsz().s[31]++;return expect(match).to.be.true;});});cov_1ycxv8bdsz().s[32]++;after(()=>{cov_1ycxv8bdsz().f[9]++;cov_1ycxv8bdsz().s[33]++;return establishments.deleteMany({}).then(mongo.disconnect);});});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZ2lzdGVyLWVzdGFibGlzaG1lbnQuc3BlYy5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiY29uZmlnIiwiZW52IiwiVEVTVF9NT05HT0RCX1VSTCIsIk1PTkdPREJfVVJMIiwiVEVTVF9BUElfVVJMIiwiQVBJX1VSTCIsInByb2Nlc3MiLCJyZWdpc3RlckVzdGFibGlzaG1lbnQiLCJyYW5kb20iLCJNYXRoIiwiZXhwZWN0IiwidXRpbHMiLCJnZW5lcmF0ZU5JRiIsIm1vbmdvIiwiYmNyeXB0IiwiY29udGV4dCIsImRlc2NyaWJlIiwiZXN0YWJsaXNobWVudHMiLCJiZWZvcmUiLCJjb25uZWN0IiwidGhlbiIsImNvbm5lY3Rpb24iLCJkYiIsImNvbGxlY3Rpb24iLCJlc3RhYmxpc2htZW50IiwibmlmIiwiZW1haWwiLCJwYXNzd29yZCIsImJlZm9yZUVhY2giLCJkZWxldGVNYW55IiwiaXQiLCJmaW5kIiwidG9BcnJheSIsImxlbmd0aCIsInRvIiwiZXF1YWwiLCJfZXN0YWJsaXNobWVudCIsInN0YWZmIiwiY29tcGFyZSIsIm1hdGNoIiwiYmUiLCJ0cnVlIiwiYWZ0ZXIiLCJkaXNjb25uZWN0Il0sIm1hcHBpbmdzIjoibzBJQWVZO21IQWZaQSxPQUFPLENBQUMsUUFBRCxDQUFQLENBQWtCQyxNQUFsQixHQUVBLEtBQU0sQ0FBRUMsR0FBRyxDQUFFLENBQUVDLGdCQUFnQixDQUFFQyxXQUFwQixDQUFpQ0MsWUFBWSxDQUFFQyxPQUEvQyxDQUFQLDJCQUFxRUMsT0FBckUsQ0FBTixDQUVBLEtBQU1DLENBQUFBLHFCQUFxQiwwQkFBR1IsT0FBTyxDQUFDLDBCQUFELENBQVYsQ0FBM0IsQ0FDQSxLQUFNLENBQUVTLE1BQUYsMkJBQWFDLElBQWIsQ0FBTixDQUNBLEtBQU0sQ0FBRUMsTUFBRiwyQkFBYVgsT0FBTyxDQUFDLE1BQUQsQ0FBcEIsQ0FBTixDLHdCQUNBQSxPQUFPLENBQUMsK0JBQUQsQ0FBUCxDQUNBLEtBQU0sQ0FBQ1ksS0FBSyxDQUFFLENBQUND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Q0FBQyxJQUFNLHdEQUFBekIsQ0FBQUEsY0FBYyxDQUFDWSxVQUFmLENBQTBCLEVBQTFCLEVBQThCVCxJQUE5QixDQUFtQ1AsS0FBSyxDQUFDOEIsVUFBekMsRUFBb0QsQ0FBM0QsQ0FBTCxDQUNILENBdkNPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCdkb3RlbnYnKS5jb25maWcoKVxuXG5jb25zdCB7IGVudjogeyBURVNUX01PTkdPREJfVVJMOiBNT05HT0RCX1VSTCwgVEVTVF9BUElfVVJMOiBBUElfVVJMICB9IH0gPSBwcm9jZXNzXG5cbmNvbnN0IHJlZ2lzdGVyRXN0YWJsaXNobWVudCA9IHJlcXVpcmUoJy4vcmVnaXN0ZXItZXN0YWJsaXNobWVudCcpXG5jb25zdCB7IHJhbmRvbSB9ID0gTWF0aFxuY29uc3QgeyBleHBlY3QgfSA9IHJlcXVpcmUoJ2NoYWknKVxucmVxdWlyZSgncXJtZW51LWNvbW1vbnMvcG9seWZpbGxzL2pzb24nKVxuY29uc3Qge3V0aWxzOiB7Z2VuZXJhdGVOSUY6IHtnZW5lcmF0ZU5JRn19fSA9IHJlcXVpcmUoJ3FybWVudS1jb21tb25zJylcbmNvbnN0IHsgbW9uZ28gfSA9IHJlcXVpcmUoJ3FybWVudS1kYXRhJylcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcbmNvbnN0IGNvbnRleHQgPSByZXF1aXJlKCcuL2NvbnRleHQnKVxucmVxdWlyZSgncXJtZW51LWNvbW1vbnMvcG9ueWZpbGxzL3hocicpXG5cbmNvbnRleHQuQVBJX1VSTCA9IEFQSV9VUkxcblxuZGVzY3JpYmUoJ2xvZ2ljIC0gcmVnaXN0ZXIgZXN0YWJsaXNobWVudCcsICgpID0+IHtcbiAgICBsZXQgZXN0YWJsaXNobWVudHNcbiAgICBiZWZvcmUoKCkgPT4gbW9uZ28uY29ubmVjdChNT05HT0RCX1VSTClcbiAgICAgICAgLnRoZW4oY29ubmVjdGlvbiA9PiBlc3RhYmxpc2htZW50cyA9IGNvbm5lY3Rpb24uZGIoKS5jb2xsZWN0aW9uKCdlc3RhYmxpc2htZW50cycpKVxuICAgIClcblxuICAgIGxldCAgZXN0YWJsaXNobWVudCwgbmlmLCBlbWFpbCwgcGFzc3dvcmRcblxuICAgIGJlZm9yZUVhY2goKCkgPT5cbiAgICAgICAgZXN0YWJsaXNobWVudHMuZGVsZXRlTWFueSgpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgZXN0YWJsaXNobWVudCA9IGBlc3RhYmxpc2htZW50LSR7cmFuZG9tKCl9YFxuICAgICAgICAgICAgICAgIG5pZiA9IGAke2dlbmVyYXRlTklGKCl9YFxuICAgICAgICAgICAgICAgIGVtYWlsID0gYGUtJHtyYW5kb20oKX1AbWFpbC5jb21gXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQgPSBgcGFzc3dvcmQtJHtyYW5kb20oKX1gXG4gICAgICAgICAgICB9KVxuICAgIClcblxuICAgIGl0KCdzaG91bGQgc3VjY2VlZCBvbiB2YWxpZCBkYXRhJywgKCkgPT5cbiAgICAgICAgXG4gICAgICAgIHJlZ2lzdGVyRXN0YWJsaXNobWVudChlc3RhYmxpc2htZW50LCBuaWYsIGVtYWlsLCBwYXNzd29yZClcbiAgICAgICAgICAgIC50aGVuKCgpID0+IGVzdGFibGlzaG1lbnRzLmZpbmQoKS50b0FycmF5KCkpXG4gICAgICAgICAgICAudGhlbihlc3RhYmxpc2htZW50cyA9PiB7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgZXhwZWN0KGVzdGFibGlzaG1lbnRzLmxlbmd0aCkudG8uZXF1YWwoMSlcblxuICAgICAgICAgICAgICAgIGNvbnN0IFtfZXN0YWJsaXNobWVudF0gPSBlc3RhYmxpc2htZW50c1xuXG4gICAgICAgICAgICAgICAgZXhwZWN0KF9lc3RhYmxpc2htZW50LmVzdGFibGlzaG1lbnQpLnRvLmVxdWFsKGVzdGFibGlzaG1lbnQpXG4gICAgICAgICAgICAgICAgZXhwZWN0KF9lc3RhYmxpc2htZW50Lm5pZikudG8uZXF1YWwobmlmKVxuICAgICAgICAgICAgICAgIGV4cGVjdChfZXN0YWJsaXNobWVudC5zdGFmZlswXS5lbWFpbCkudG8uZXF1YWwoZW1haWwpXG5cbiAgICAgICAgICAgICAgICByZXR1cm4gYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIF9lc3RhYmxpc2htZW50LnN0YWZmWzBdLnBhc3N3b3JkKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKG1hdGNoID0+IGV4cGVjdChtYXRjaCkudG8uYmUudHJ1ZSlcbiAgICApXG5cblxuICAgIGFmdGVyKCgpID0+IGVzdGFibGlzaG1lbnRzLmRlbGV0ZU1hbnkoe30pLnRoZW4obW9uZ28uZGlzY29ubmVjdCkpXG59KSJdfQ==