function cov_1qzvis8juj(){var path="/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-client-logic/is-user-authenticated.spec.js";var hash="8348068858413210521d0e931c31550a0734698a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/marcgm97/bootcamp/collab/skylab-bootcamp-202004/staff/marc-guillemas/qrmenu/qrmenu-client-logic/is-user-authenticated.spec.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:26}},"1":{start:{line:2,column:0},end:{line:2,column:39}},"2":{start:{line:3,column:51},end:{line:3,column:58}},"3":{start:{line:5,column:31},end:{line:5,column:56}},"4":{start:{line:8,column:28},end:{line:8,column:62}},"5":{start:{line:9,column:19},end:{line:9,column:23}},"6":{start:{line:10,column:19},end:{line:10,column:34}},"7":{start:{line:11,column:0},end:{line:11,column:40}},"8":{start:{line:12,column:48},end:{line:12,column:70}},"9":{start:{line:13,column:15},end:{line:13,column:34}},"10":{start:{line:14,column:46},end:{line:14,column:71}},"11":{start:{line:16,column:0},end:{line:82,column:2}},"12":{start:{line:17,column:4},end:{line:17,column:47}},"13":{start:{line:17,column:17},end:{line:17,column:46}},"14":{start:{line:21,column:4},end:{line:32,column:5}},"15":{start:{line:22,column:8},end:{line:31,column:36}},"16":{start:{line:24,column:12},end:{line:24,column:46}},"17":{start:{line:25,column:12},end:{line:25,column:32}},"18":{start:{line:26,column:12},end:{line:26,column:44}},"19":{start:{line:27,column:12},end:{line:27,column:44}},"20":{start:{line:29,column:12},end:{line:29,column:44}},"21":{start:{line:31,column:23},end:{line:31,column:35}},"22":{start:{line:34,column:4},end:{line:75,column:6}},"23":{start:{line:36,column:8},end:{line:44,column:9}},"24":{start:{line:37,column:12},end:{line:43,column:47}},"25":{start:{line:39,column:20},end:{line:39,column:55}},"26":{start:{line:40,column:20},end:{line:40,column:57}},"27":{start:{line:42,column:28},end:{line:42,column:102}},"28":{start:{line:43,column:32},end:{line:43,column:46}},"29":{start:{line:46,column:8},end:{line:55,column:10}},"30":{start:{line:48,column:12},end:{line:53,column:18}},"31":{start:{line:51,column:20},end:{line:51,column:55}},"32":{start:{line:57,column:8},end:{line:71,column:10}},"33":{start:{line:58,column:12},end:{line:58,column:28}},"34":{start:{line:59,column:12},end:{line:69,column:13}},"35":{start:{line:60,column:16},end:{line:65,column:22}},"36":{start:{line:63,column:24},end:{line:63,column:70}},"37":{start:{line:68,column:16},end:{line:68,column:38}},"38":{start:{line:79,column:4},end:{line:79,column:47}},"39":{start:{line:79,column:20},end:{line:79,column:46}},"40":{start:{line:81,column:4},end:{line:81,column:30}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:16,column:38},end:{line:16,column:39}},loc:{start:{line:16,column:44},end:{line:82,column:1}},line:16},"1":{name:"(anonymous_1)",decl:{start:{line:17,column:11},end:{line:17,column:12}},loc:{start:{line:17,column:17},end:{line:17,column:46}},line:17},"2":{name:"(anonymous_2)",decl:{start:{line:21,column:15},end:{line:21,column:16}},loc:{start:{line:22,column:8},end:{line:31,column:36}},line:22},"3":{name:"(anonymous_3)",decl:{start:{line:23,column:14},end:{line:23,column:15}},loc:{start:{line:23,column:20},end:{line:30,column:9}},line:23},"4":{name:"(anonymous_4)",decl:{start:{line:31,column:14},end:{line:31,column:15}},loc:{start:{line:31,column:23},end:{line:31,column:35}},line:31},"5":{name:"(anonymous_5)",decl:{start:{line:34,column:41},end:{line:34,column:42}},loc:{start:{line:34,column:47},end:{line:75,column:5}},line:34},"6":{name:"(anonymous_6)",decl:{start:{line:36,column:19},end:{line:36,column:20}},loc:{start:{line:37,column:12},end:{line:43,column:47}},line:37},"7":{name:"(anonymous_7)",decl:{start:{line:38,column:22},end:{line:38,column:23}},loc:{start:{line:38,column:39},end:{line:41,column:17}},line:38},"8":{name:"(anonymous_8)",decl:{start:{line:42,column:22},end:{line:42,column:23}},loc:{start:{line:42,column:28},end:{line:42,column:102}},line:42},"9":{name:"(anonymous_9)",decl:{start:{line:43,column:22},end:{line:43,column:23}},loc:{start:{line:43,column:32},end:{line:43,column:46}},line:43},"10":{name:"(anonymous_10)",decl:{start:{line:46,column:46},end:{line:46,column:47}},loc:{start:{line:46,column:52},end:{line:55,column:9}},line:46},"11":{name:"(anonymous_11)",decl:{start:{line:49,column:22},end:{line:49,column:23}},loc:{start:{line:49,column:42},end:{line:53,column:17}},line:49},"12":{name:"(anonymous_12)",decl:{start:{line:57,column:41},end:{line:57,column:42}},loc:{start:{line:57,column:47},end:{line:71,column:9}},line:57},"13":{name:"(anonymous_13)",decl:{start:{line:61,column:26},end:{line:61,column:27}},loc:{start:{line:61,column:32},end:{line:65,column:21}},line:61},"14":{name:"(anonymous_14)",decl:{start:{line:79,column:14},end:{line:79,column:15}},loc:{start:{line:79,column:20},end:{line:79,column:46}},line:79}},branchMap:{},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},b:{},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"8348068858413210521d0e931c31550a0734698a"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1qzvis8juj=function(){return actualCoverage;};}return actualCoverage;}cov_1qzvis8juj();cov_1qzvis8juj().s[0]++;require('dotenv').config();cov_1qzvis8juj().s[1]++;global.XMLHttpRequest=require('xhr2');const{env:{TEST_MONGODB_URL:MONGODB_URL}}=(cov_1qzvis8juj().s[2]++,process);// const jwt = require('jwt')
const{utils:{jwtPromised}}=(cov_1qzvis8juj().s[3]++,require('qrmenu-commons'));const isUserAuthenticated=(cov_1qzvis8juj().s[4]++,require('./is-user-authenticated'));const{random}=(cov_1qzvis8juj().s[5]++,Math);const{expect}=(cov_1qzvis8juj().s[6]++,require('chai'));cov_1qzvis8juj().s[7]++;require('qrmenu-commons/polyfills/json');const{mongoose,models:{Establishment}}=(cov_1qzvis8juj().s[8]++,require('qrmenu-data'));const bcrypt=(cov_1qzvis8juj().s[9]++,require('bcryptjs'));const{utils:{generateNIF:{generateNIF}}}=(cov_1qzvis8juj().s[10]++,require('qrmenu-commons'));cov_1qzvis8juj().s[11]++;describe('logic - authenticate user',()=>{cov_1qzvis8juj().f[0]++;cov_1qzvis8juj().s[12]++;before(()=>{cov_1qzvis8juj().f[1]++;cov_1qzvis8juj().s[13]++;return mongoose.connect(MONGODB_URL);});let establishment,nif,email,password,establishmentId,hash,workerId,token;cov_1qzvis8juj().s[14]++;beforeEach(()=>{cov_1qzvis8juj().f[2]++;cov_1qzvis8juj().s[15]++;return Establishment.deleteMany().then(()=>{cov_1qzvis8juj().f[3]++;cov_1qzvis8juj().s[16]++;establishment=`name-${random()}`;cov_1qzvis8juj().s[17]++;nif=generateNIF();cov_1qzvis8juj().s[18]++;email=`e-${random()}@mail.com`;cov_1qzvis8juj().s[19]++;password=`password${random()}`;cov_1qzvis8juj().s[20]++;return bcrypt.hash(password,10);}).then(_hash=>{cov_1qzvis8juj().f[4]++;cov_1qzvis8juj().s[21]++;return hash=_hash;});});// {establishmentId: establishment._id, workerId: user._id}
cov_1qzvis8juj().s[22]++;describe('when user already exists',()=>{cov_1qzvis8juj().f[5]++;cov_1qzvis8juj().s[23]++;beforeEach(()=>{cov_1qzvis8juj().f[6]++;cov_1qzvis8juj().s[24]++;return Establishment.create({establishment,nif,staff:[{email,password:hash}]}).then(_establishment=>{cov_1qzvis8juj().f[7]++;cov_1qzvis8juj().s[25]++;establishmentId=_establishment.id;cov_1qzvis8juj().s[26]++;workerId=_establishment.staff[0].id;}).then(()=>{cov_1qzvis8juj().f[8]++;cov_1qzvis8juj().s[27]++;return jwtPromised.sign({establishmentId,workerId},"SECRET",{expiresIn:'1d'});}).then(_token=>{cov_1qzvis8juj().f[9]++;cov_1qzvis8juj().s[28]++;return token=_token;});});cov_1qzvis8juj().s[29]++;it('should succeed on correct token',()=>{cov_1qzvis8juj().f[10]++;cov_1qzvis8juj().s[30]++;isUserAuthenticated(token).then(_isAuthenticated=>{cov_1qzvis8juj().f[11]++;cov_1qzvis8juj().s[31]++;expect(_isAuthenticated).to.be.true;});});cov_1qzvis8juj().s[32]++;it('should fail on wrong token',()=>{cov_1qzvis8juj().f[12]++;cov_1qzvis8juj().s[33]++;token+="wrong";cov_1qzvis8juj().s[34]++;try{cov_1qzvis8juj().s[35]++;isUserAuthenticated(token).then(()=>{cov_1qzvis8juj().f[13]++;cov_1qzvis8juj().s[36]++;throw new Error('should not reach this point');});}catch(error){cov_1qzvis8juj().s[37]++;expect(error).to.exist;}});});cov_1qzvis8juj().s[38]++;afterEach(()=>{cov_1qzvis8juj().f[14]++;cov_1qzvis8juj().s[39]++;return Establishment.deleteMany();});cov_1qzvis8juj().s[40]++;after(mongoose.disconnect);});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlzLXVzZXItYXV0aGVudGljYXRlZC5zcGVjLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJjb25maWciLCJnbG9iYWwiLCJYTUxIdHRwUmVxdWVzdCIsImVudiIsIlRFU1RfTU9OR09EQl9VUkwiLCJNT05HT0RCX1VSTCIsInByb2Nlc3MiLCJ1dGlscyIsImp3dFByb21pc2VkIiwiaXNVc2VyQXV0aGVudGljYXRlZCIsInJhbmRvbSIsIk1hdGgiLCJleHBlY3QiLCJtb25nb29zZSIsIm1vZGVscyIsIkVzdGFibGlzaG1lbnQiLCJiY3J5cHQiLCJnZW5lcmF0ZU5JRiIsImRlc2NyaWJlIiwiYmVmb3JlIiwiY29ubmVjdCIsImVzdGFibGlzaG1lbnQiLCJuaWYiLCJlbWFpbCIsInBhc3N3b3JkIiwiZXN0YWJsaXNobWVudElkIiwiaGFzaCIsIndvcmtlcklkIiwidG9rZW4iLCJiZWZvcmVFYWNoIiwiZGVsZXRlTWFueSIsInRoZW4iLCJfaGFzaCIsImNyZWF0ZSIsInN0YWZmIiwiX2VzdGFibGlzaG1lbnQiLCJpZCIsInNpZ24iLCJleHBpcmVzSW4iLCJfdG9rZW4iLCJpdCIsIl9pc0F1dGhlbnRpY2F0ZWQiLCJ0byIsImJlIiwidHJ1ZSIsIkVycm9yIiwiZXJyb3IiLCJleGlzdCIsImFmdGVyRWFjaCIsImFmdGVyIiwiZGlzY29ubmVjdCJdLCJtYXBwaW5ncyI6ImtoTEFlWTttSEFmWkEsT0FBTyxDQUFDLFFBQUQsQ0FBUCxDQUFrQkMsTUFBbEIsRyx3QkFDQUMsTUFBTSxDQUFDQyxjQUFQLENBQXdCSCxPQUFPLENBQUMsTUFBRCxDQUEvQixDQUNBLEtBQU0sQ0FBRUksR0FBRyxDQUFFLENBQUVDLGdCQUFnQixDQUFFQyxXQUFwQixDQUFQLDJCQUE2Q0MsT0FBN0MsQ0FBTixDQUNBO0FBQ0EsS0FBTSxDQUFDQyxLQUFLLENBQUUsQ0FBQ0MsV0FBRCxDQUFSLDJCQUF5QlQsT0FBTyxDQUFDLGdCQUFELENBQWhDLENBQU4sQ0FHQSxLQUFNVSxDQUFBQSxtQkFB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QVRDLENBQUYsQ0FadUMseUJBdUJ2Q0osRUFBRSxDQUFDLDRCQUFELENBQStCLElBQU0sbURBQ25DWixLQUFLLEVBQUksT0FBVCxDQURtQyx5QkFFbkMsR0FBSSwwQkFDQW5CLG1CQUFtQixDQUFDbUIsS0FBRCxDQUFuQixDQUNLRyxJQURMLENBQ1UsSUFBTSxtREFFUixLQUFNLElBQUljLENBQUFBLEtBQUosQ0FBVSw2QkFBVixDQUFOLENBRUgsQ0FMTCxFQU9ILENBQUMsTUFBT0MsS0FBUCxDQUFjLDBCQUNabEMsTUFBTSxDQUFDa0MsS0FBRCxDQUFOLENBQWNKLEVBQWQsQ0FBaUJLLEtBQWpCLENBQ0gsQ0FFSixDQWRDLENBQUYsQ0FrQkgsQ0F6Q08sQ0FBUixDQWxCd0MseUJBK0R4Q0MsU0FBUyxDQUFDLElBQU0seURBQUFqQyxDQUFBQSxhQUFhLENBQUNlLFVBQWQsR0FBMEIsQ0FBakMsQ0FBVCxDQS9Ed0MseUJBaUV4Q21CLEtBQUssQ0FBQ3BDLFFBQVEsQ0FBQ3FDLFVBQVYsQ0FBTCxDQUNILENBbEVPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCdkb3RlbnYnKS5jb25maWcoKVxuZ2xvYmFsLlhNTEh0dHBSZXF1ZXN0ID0gcmVxdWlyZSgneGhyMicpXG5jb25zdCB7IGVudjogeyBURVNUX01PTkdPREJfVVJMOiBNT05HT0RCX1VSTCB9IH0gPSBwcm9jZXNzXG4vLyBjb25zdCBqd3QgPSByZXF1aXJlKCdqd3QnKVxuY29uc3Qge3V0aWxzOiB7and0UHJvbWlzZWR9fSA9IHJlcXVpcmUoJ3FybWVudS1jb21tb25zJylcblxuXG5jb25zdCBpc1VzZXJBdXRoZW50aWNhdGVkID0gcmVxdWlyZSgnLi9pcy11c2VyLWF1dGhlbnRpY2F0ZWQnKVxuY29uc3QgeyByYW5kb20gfSA9IE1hdGhcbmNvbnN0IHsgZXhwZWN0IH0gPSByZXF1aXJlKCdjaGFpJylcbnJlcXVpcmUoJ3FybWVudS1jb21tb25zL3BvbHlmaWxscy9qc29uJylcbmNvbnN0IHsgbW9uZ29vc2UsIG1vZGVsczogeyBFc3RhYmxpc2htZW50IH0gfSA9IHJlcXVpcmUoJ3FybWVudS1kYXRhJylcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcbmNvbnN0IHt1dGlsczoge2dlbmVyYXRlTklGOiB7Z2VuZXJhdGVOSUZ9fX0gPSByZXF1aXJlKCdxcm1lbnUtY29tbW9ucycpXG5cbmRlc2NyaWJlKCdsb2dpYyAtIGF1dGhlbnRpY2F0ZSB1c2VyJywgKCkgPT4ge1xuICAgIGJlZm9yZSgoKSA9PiBtb25nb29zZS5jb25uZWN0KE1PTkdPREJfVVJMKSlcblxuICAgIGxldCBlc3RhYmxpc2htZW50LCBuaWYsIGVtYWlsLCBwYXNzd29yZCwgZXN0YWJsaXNobWVudElkLCBoYXNoLCB3b3JrZXJJZCwgdG9rZW5cblxuICAgIGJlZm9yZUVhY2goKCkgPT5cbiAgICAgICAgRXN0YWJsaXNobWVudC5kZWxldGVNYW55KClcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgZXN0YWJsaXNobWVudCA9IGBuYW1lLSR7cmFuZG9tKCl9YFxuICAgICAgICAgICAgbmlmID0gIGdlbmVyYXRlTklGKClcbiAgICAgICAgICAgIGVtYWlsID0gYGUtJHtyYW5kb20oKX1AbWFpbC5jb21gXG4gICAgICAgICAgICBwYXNzd29yZCA9IGBwYXNzd29yZCR7cmFuZG9tKCl9YFxuXG4gICAgICAgICAgICByZXR1cm4gYmNyeXB0Lmhhc2gocGFzc3dvcmQsIDEwKVxuICAgICAgICB9KVxuICAgICAgICAudGhlbihfaGFzaCA9PiBoYXNoID0gX2hhc2gpXG4gICAgKVxuICAgIC8vIHtlc3RhYmxpc2htZW50SWQ6IGVzdGFibGlzaG1lbnQuX2lkLCB3b3JrZXJJZDogdXNlci5faWR9XG4gICAgZGVzY3JpYmUoJ3doZW4gdXNlciBhbHJlYWR5IGV4aXN0cycsICgpID0+IHtcbiAgICAgICAgXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT5cbiAgICAgICAgICAgIEVzdGFibGlzaG1lbnQuY3JlYXRlKHsgZXN0YWJsaXNobWVudCwgbmlmLCBzdGFmZjogW3tlbWFpbCwgcGFzc3dvcmQ6IGhhc2h9XSB9KVxuICAgICAgICAgICAgICAgIC50aGVuKF9lc3RhYmxpc2htZW50ID0+eyBcbiAgICAgICAgICAgICAgICAgICAgZXN0YWJsaXNobWVudElkID0gX2VzdGFibGlzaG1lbnQuaWQgXG4gICAgICAgICAgICAgICAgICAgIHdvcmtlcklkID0gX2VzdGFibGlzaG1lbnQuc3RhZmZbMF0uaWRcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IGp3dFByb21pc2VkLnNpZ24oe2VzdGFibGlzaG1lbnRJZCwgd29ya2VySWR9LCBcIlNFQ1JFVFwiLCB7ZXhwaXJlc0luOiAnMWQnfSkpXG4gICAgICAgICAgICAgICAgLnRoZW4oX3Rva2VuID0+IHRva2VuID0gX3Rva2VuKVxuICAgICAgICApXG5cbiAgICAgICAgaXQoJ3Nob3VsZCBzdWNjZWVkIG9uIGNvcnJlY3QgdG9rZW4nLCAoKSA9PiB7XG5cbiAgICAgICAgICAgIGlzVXNlckF1dGhlbnRpY2F0ZWQodG9rZW4pXG4gICAgICAgICAgICAgICAgLnRoZW4oX2lzQXV0aGVudGljYXRlZCA9PiB7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChfaXNBdXRoZW50aWNhdGVkKS50by5iZS50cnVlXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgIFxuICAgICAgICB9KVxuXG4gICAgICAgIGl0KCdzaG91bGQgZmFpbCBvbiB3cm9uZyB0b2tlbicsICgpID0+IHtcbiAgICAgICAgICAgIHRva2VuICs9IFwid3JvbmdcIlxuICAgICAgICAgICAgdHJ5IHsgXG4gICAgICAgICAgICAgICAgaXNVc2VyQXV0aGVudGljYXRlZCh0b2tlbilcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignc2hvdWxkIG5vdCByZWFjaCB0aGlzIHBvaW50JylcbiAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGV4cGVjdChlcnJvcikudG8uZXhpc3RcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgXG4gICAgICAgIH0pXG5cbiAgICAgICBcblxuICAgIH0pXG5cblxuXG4gICAgYWZ0ZXJFYWNoKCgpID0+IEVzdGFibGlzaG1lbnQuZGVsZXRlTWFueSgpKVxuXG4gICAgYWZ0ZXIobW9uZ29vc2UuZGlzY29ubmVjdClcbn0pIl19